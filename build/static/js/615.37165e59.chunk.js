"use strict";(self.webpackChunkpc=self.webpackChunkpc||[]).push([[615],{615:(e,t,o)=>{o.r(t),o.d(t,{default:()=>U});var a=o(5043),n=o(579);const l=(0,a.createContext)({currLayer:0,layers:[],setLayers:()=>{},lastLayer:0,setLastLayer:()=>{},name:"",setName:()=>{},setCurrLayer:()=>{},history:{},setHistory:()=>{},dimentions:{},setDimentions:()=>{},useAlpha:!1,setUseAlpha:()=>{},newParams:{},setNewParams:()=>{},tool:"",setTool:()=>{},brushPoints:{},setBrushPoints:()=>{},subTool:{},setSubTool:()=>{},curveControls:{},setCurveControls:()=>{},color:{},setColor:()=>{},size:0,setSize:()=>{},text:{},setText:()=>{},clipboard:{},setClipboard:()=>{},zoom:1,setZoom:()=>{},cursor:{},setCursor:()=>{},view:{},setView:()=>{}});const r=function(e){let{children:t}=e;const[o,r]=(0,a.useState)(0),[s,i]=(0,a.useState)([{id:0,name:"Base",blending:"normal",filters:{},opacity:1,visible:!0,locked:!1,canUndo:!1,canRedo:!1}]),[c,d]=(0,a.useState)(0),[h,u]=(0,a.useState)("Untitled"),[x,p]=(0,a.useState)({0:{data:[],lastIndex:0}}),[g,b]=(0,a.useState)({width:350,height:350}),[m,y]=(0,a.useState)(!1),[v,f]=(0,a.useState)({width:350,height:350,alpha:!1,name:"Untitled"}),[w,C]=(0,a.useState)("Brush"),[j,M]=(0,a.useState)([]),[P,k]=(0,a.useState)({shape:"Circle",fill:!1,stretch:!1,sides:4,angle:0,startAngle:0,lineJoin:"round",lineCap:"round",radii:[10,10,10,10]}),[S,T]=(0,a.useState)({state:"none",start:{x:-1,y:-1},end:{x:-1,y:-1},controlPoint1:{x:-1,y:-1},controlPoint2:{x:-1,y:-1}}),[D,I]=(0,a.useState)({selected:"hsl(0, 100%, 0%)",1:"hsla(0, 100%, 0%, 1)",2:"hsla(0, 100%, 100%, 1)"}),[B,L]=(0,a.useState)(16),[N,E]=(0,a.useState)({text:"",fill:!0,stroke:!1,strokeWidth:2,lineHeight:1.2,fontFamily:"Arial",state:"none"}),[A,z]=(0,a.useState)({data:{},state:"none"}),[R,$]=(0,a.useState)(1),[F,U]=(0,a.useState)({current:{x:0,y:0},start:{x:0,y:0},end:{x:0,y:0},down:!1,selecting:!1}),[Z,O]=(0,a.useState)({toolBar:!0,contentBar:!0,topNavBar:!0,bottomNavBar:!0,menu:!0}),W={currLayer:o,layers:s,setLayers:i,lastLayer:c,setLastLayer:d,name:h,setName:u,history:x,setHistory:p,setCurrLayer:r,dimentions:g,setDimentions:b,useAlpha:m,setUseAlpha:y,newParams:v,setNewParams:f,tool:w,setTool:C,brushPoints:j,setBrushPoints:M,subTool:P,setSubTool:k,curveControls:S,setCurveControls:T,color:D,setColor:I,size:B,setSize:L,text:N,setText:E,clipboard:A,setClipboard:z,zoom:R,setZoom:$,cursor:F,setCursor:U,view:Z,setView:O};return(0,n.jsx)(l.Provider,{value:W,children:t})},s=(e,t,o,a,n)=>{let l;l=e.getContext("2d",{alpha:!0}),l.webkitImageSmoothingEnabled=!1,l.mozImageSmoothingEnabled=!1,l.imageSmoothingEnabled=!1;const r=l.canvas.height,s=l.canvas.width,i=t.current.x,c=t.current.y,d=t.start.x,h=t.start.y,u=t.end.x,x=t.end.y,p=()=>{l.strokeStyle=o.selectedColor,l.fillStyle=o.selectedColor,l.lineWidth=1,l.setLineDash([]),l.beginPath(),l.arc(i,c,o.size,0,2*Math.PI),a?l.stroke():l.fill(),l.closePath()},g={drawBrush:()=>{"drawing"!==n&&"finished"!==n?(l.strokeStyle=o.selectedColor,l.fillStyle=o.selectedColor,l.lineWidth=1,l.setLineDash([]),l.beginPath(),l.arc(i,c,o.size/2,0,2*Math.PI),l.fill(),l.stroke(),l.closePath()):"drawing"===n&&o.brushPoints.length>1&&(l.strokeStyle=o.selectedColor,l.lineWidth=o.size,l.lineCap="round",l.lineJoin="round",l.setLineDash([]),l.beginPath(),l.moveTo(o.brushPoints[o.brushPoints.length-2][0],o.brushPoints[o.brushPoints.length-2][1]),l.lineTo(o.brushPoints[o.brushPoints.length-1][0],o.brushPoints[o.brushPoints.length-1][1]),l.stroke())},drawEraser:p,drawSpray:()=>{let e=Math.random()*o.size,t=Math.random(),a=Math.random()*o.size,n=Math.random();for(;Math.sqrt(Math.pow(e,2)+Math.pow(a,2))>o.size;)e=Math.random()*o.size,a=Math.random()*o.size;n>.5&&(a*=-1),t>.5&&(e*=-1),l.fillStyle=o.selectedColor,l.fillRect(i+e,c+a,1,1)},drawBucket:()=>{let e,t,a,n,d,h,u,x=[];for(let S=0;S<o.selectedColor.length;S++){var p,g;"("===o.selectedColor[S]?p=S+1:")"===o.selectedColor[S]?(g=S,x.push(o.selectedColor.slice(p,g))):","===o.selectedColor[S]&&(x.push(o.selectedColor.slice(p,S)),p=S+1)}if(n=x[0]/360,d=x[1].slice(0,-1)/100,h=x[2].slice(0,-1)/100,u=Math.round(255*x[3]),0===d)e=255*h,t=255*h,a=255*h;else{let T,D,I,B,L;function N(e){return e<0?e+1:e>1?e-1:e}function E(e,t,o){return 6*o<1?t+6*(e-t)*o:2*o<1?e:3*o<2?t+(e-t)*(2/3-o)*6:t}T=h<.5?h*(1+d):h+d-h*d,D=2*h-T,I=N(n+1/3),B=N(n),L=N(n-1/3),e=Math.round(255*E(T,D,I)),t=Math.round(255*E(T,D,B)),a=Math.round(255*E(T,D,L))}function b(e){var t=Number(e).toString(16);return 1==t.length?"0"+t:t}let m="#"+b(e)+b(t)+b(a)+b(u),y=[],v=parseInt(m.slice(7,9)+m.slice(5,7)+m.slice(3,5)+m.slice(1,3),16);const f=l.getImageData(0,0,s,r),w={width:f.width,height:f.height,data:new Uint32Array(f.data.buffer)};function C(e,t){return e<0||t<0||e>=w.width||t>=w.height?-1:w.data[t*f.width+e]}let j=C(Math.floor(i),Math.floor(c));if(-1===j||j===v)return;const M=(e,t,o,a)=>{y.push({left:e,right:t,line:o,direction:a})},P=(e,t,o,a)=>{let n,l,s=!1;if(!(o>=r||o<0)){for(l=e;l<t;++l){C(l,o)===j?s||(s=!0,n=l):s&&(s=!1,M(n,l-1,o,a))}s&&(s=!1,M(n,t-1,o,a))}};M(Math.floor(i),Math.floor(i),Math.floor(c),0);let k=0;for(;y.length>0&&k<5e3;){k++;const{left:A,right:z,line:R,direction:$}=y.pop();let F=A;for(;F>=0&&C(F,R)===j;F--);++F;let U=z;for(;U<s&&C(U,R)===j;++U);const Z=R*s;Z+U>w.data.length?(console.log("Attempt to access pixel data array beyond its maximum length"),w.data.fill(v,Z+F,w.data.length)):w.data.fill(v,Z+F,Z+U),$<=0?P(F,U,R-1,-1):(P(F,A,R-1,-1),P(z,U,R-1,-1)),$>=0?P(F,U,R+1,1):(P(F,A,R+1,1),P(z,U,R+1,1))}k>=5e3&&console.error("Bucket Tool maximum iterations exceeded, consider using a smaller canvas."),l.putImageData(f,0,0)},drawText:()=>{l.fillStyle=o.selectedColor,l.strokeStyle=o.selectedColor===o.color1?o.color2:o.color1,l.lineWidth=o.text.strokeWidth,l.font=String(o.size+"px "+o.text.fontFamily);let e=o.text.text.split("\n"),t=0,a=u>d?u-d:d-u,n=u>d?d:u,r=x>h?h:x,s=0;for(;t<e.length&&s<500;){if(l.measureText(e[t]).width>a){let o=e[t][0],n=1,r=0;for(;l.measureText(o).width<a&&r<500;)o+=e[t][n],n++,r++;let s=e[t].substring(n-1,e[t].length);e[t]=o.substring(0,n-1),e=e.toSpliced(t+1,0,s)}t++,s++}e.forEach(((e,t)=>{o.text.fill&&l.fillText(e,n,r+o.size+o.size*o.text.lineHeight*t),o.text.stroke&&l.strokeText(e,n,r+o.size+o.size*o.text.lineHeight*t)}))},drawPipette:()=>{let e=l.getImageData(i,c,1,1),t=e.data[0],a=e.data[1],n=e.data[2],r=e.data[3];t/=255,a/=255,n/=255,r/=255;let s=Math.min(t,a,n),d=Math.max(t,a,n),h=d-s,u=0,x=0,p=(d+s)/2;0===h?(x=0,u=0):(x=p<=.5?h/(d+s):h/(2-d-s),d===t?u=(a-n)/h:d===a?u=(n-t)/h+2:d===n&&(u=(t-a)/h+4)),u=Math.round(60*u),u<0&&(u+=360),x=Math.abs(100*x).toFixed(0),p=(100*p).toFixed(0);let g="hsla("+u+","+x+"%,"+p+"%,"+r+")";if("Pipette"!==o.tool)return g;o.selectedColor===o.color1?o.setColor1(g):o.setColor2(g)},drawSelect:()=>{switch(o.clipboard.state){case"copy":if(!a&&u-d!==0&&x-h!==0){let e=l.getImageData(d,h,u-d,x-h);o.setClipboard({data:e,state:"carry"})}break;case"cut":if(!a&&u-d!==0&&x-h!==0){let e=l.getImageData(d,h,u-d,x-h);o.setClipboard({data:e,state:"carry"}),o.selectedColor===o.color1?l.fillStyle=o.color2:l.fillStyle=o.color1,l.fillRect(d,h,u-d,x-h)}break;case"carry":const e=document.getElementById("carryCanvas").getContext("2d");e.height=o.clipboard.data.height,e.width=o.clipboard.data.width,e.putImageData(o.clipboard.data,0,0),l.putImageData(o.clipboard.data,u,x);break;case"paste":if(!a){const e=document.getElementById("carryCanvas");l.drawImage(e,u,x),o.setClipboard({...o.clipboard,state:"none"})}}},drawShape:()=>{l.strokeStyle=o.color1,l.fillStyle=o.color2,"Curve"!==o.subTool.shape&&"Line"!==o.subTool.shape?l.lineCap=o.subTool.lineCap:l.lineCap="round",l.lineJoin=o.subTool.lineJoin,l.setLineDash([]),l.lineWidth=o.size;let e,t=(u-d)/2,a=(x-h)/2;e=Math.sqrt(Math.pow(u-d,2))/2<Math.sqrt(Math.pow(x-h,2))/2?Math.sqrt(Math.pow(u-d,2))/2:Math.sqrt(Math.pow(x-h,2))/2;let n=Math.sqrt(Math.pow((u-d)/(x-h),2)),r=Math.sqrt(Math.pow((x-h)/(u-d),2));o.subTool.stretch?n>r?r=1:n=1:(n=1,r=1),"Curve"!==o.subTool.shape&&"Line"!==o.subTool.shape&&(l.save(),l.translate(d+t,h+a),l.rotate(Math.PI*o.subTool.angle/180)),"Rectangle"===o.subTool.shape||"Squagle"===o.subTool.shape?g["draw"+o.subTool.shape](t,a):g["draw"+o.subTool.shape](n,r,e),"Line"!==o.subTool.shape&&"Curve"!==o.subTool.shape&&l.restore()},drawLine:()=>{l.beginPath(),l.moveTo(d,h),l.lineTo(u,x),l.stroke()},drawCurve:()=>{let e={x:0,y:0},t={x:0,y:0},a={x:0,y:0},n={x:0,y:0};l.beginPath(),-1===o.curveControls.start.x?(e={x:d,y:h},t={x:u,y:x},a={x:d,y:h},n={x:u,y:x}):-1===o.curveControls.controlPoint1.x?(e=o.curveControls.start,t=o.curveControls.end,a={x:u,y:x},n=o.curveControls.end):-1===o.curveControls.controlPoint2.x?(e=o.curveControls.start,t=o.curveControls.end,a=o.curveControls.controlPoint1,n={x:u,y:x}):(e=o.curveControls.start,t=o.curveControls.end,a=o.curveControls.controlPoint1,n=o.curveControls.controlPoint2),l.moveTo(e.x,e.y),l.bezierCurveTo(a.x,a.y,n.x,n.y,t.x,t.y),l.stroke()},drawCircle:(e,t,a)=>{l.beginPath(),l.ellipse(0,0,e*a,t*a,0,0,2*Math.PI),o.subTool.fill&&l.fill(),l.stroke()},drawRectangle:(e,t)=>{o.subTool.fill&&l.fillRect(-e,-t,u-d,x-h),l.strokeRect(-e,-t,u-d,x-h)},drawSquagle:(e,t)=>{l.beginPath(),l.roundRect(-e,-t,u-d,x-h,o.subTool.radii),l.stroke(),o.subTool.fill&&l.fill()},drawPolygon:(e,t,a)=>{l.beginPath();for(let n=0;n<o.subTool.sides+2;n++)l.lineTo(e*a*Math.cos(2*Math.PI*n/o.subTool.sides-Math.PI/2+Math.PI/180*o.subTool.startAngle),t*a*Math.sin(2*Math.PI*n/o.subTool.sides-Math.PI/2+Math.PI/180*o.subTool.startAngle));o.subTool.fill&&l.fill(),l.stroke()},drawStar:(e,t,a)=>{l.beginPath();for(let n=0;n<2*o.subTool.sides+2;n++)n%2===0?l.lineTo(e*a*Math.cos(Math.PI*n/o.subTool.sides-Math.PI/2+Math.PI/180*o.subTool.startAngle),t*a*Math.sin(Math.PI*n/o.subTool.sides-Math.PI/2+Math.PI/180*o.subTool.startAngle)):l.lineTo(e*a/3*Math.cos(Math.PI*n/o.subTool.sides-Math.PI/2+Math.PI/180*o.subTool.startAngle),t*a/3*Math.sin(Math.PI*n/o.subTool.sides-Math.PI/2+Math.PI/180*o.subTool.startAngle));o.subTool.fill&&l.fill(),l.stroke()},drawArrow:(e,t,a)=>{l.beginPath(),l.moveTo(e*-a*Math.cos(Math.PI/8),t*-a*Math.sin(Math.PI/8)),l.lineTo(0,t*-a*Math.sin(Math.PI/8)),l.lineTo(0,t*-a),l.lineTo(e*a,0),l.lineTo(0,t*a),l.lineTo(0,t*a*Math.sin(Math.PI/8)),l.lineTo(e*-a*Math.cos(Math.PI/8),t*a*Math.sin(Math.PI/8)),l.closePath(),o.subTool.fill&&l.fill(),l.stroke()},drawHeart:(e,t,a)=>{o.subTool.stretch&&(e>t?l.scale(e,1):l.scale(1,t)),l.beginPath(),l.moveTo(0,a),l.arc(-a/2,-a/5,a/2,3*Math.PI/4,0,!1),l.arc(a/2,-a/5,a/2,Math.PI,Math.PI/4,!1),l.closePath(),o.subTool.fill&&l.fill(),l.stroke()}};if(a){if(l.clearRect(0,0,s,r),"Magnifier"!==o.tool){if("Bucket"===o.tool||"Pipette"===o.tool)return;"Spray"===o.tool?p():g["draw"+o.tool]()}}else"Magnifier"!==o.tool&&g["draw"+o.tool]()},i=(e,t,o,a,n,l)=>{switch(a.tool){case"Brush":case"Eraser":s(e,t,a,!1,n),"drawing"!==n?(a.setBrushPoints([[t.current.x,t.current.y]]),l("drawing")):a.setBrushPoints([...a.brushPoints,[t.current.x,t.current.y]]);break;case"Bucket":s(e,t,a,!1),l("finished");break;case"Spray":for(let o=0;o<10;o++)s(e,t,a,!1);l("spraying");break;case"Text":0!==t.current.x&&0!==t.current.y&&a.setText({...a.text,state:"preview"}),"confirm"===n&&(s(e,t,a,!1),a.setText({...a.text,text:"",state:"none"}),l("finished"));break;case"Pipette":s(e,t,a,!1);break;case"Magnifier":default:break;case"Select":"clipping"===n&&"carry"!==a.clipboard.state?s(e,t,a,!1):"confirm"===n&&(s(e,t,a,!1),l("finished"));break;case"Shape":if("Curve"===a.subTool.shape&&t.down){let e=a.curveControls.state,o=a.curveControls.start,r=a.curveControls.end,s=a.curveControls.controlPoint1,i=a.curveControls.controlPoint2;"none"===a.curveControls.state?(l("settingPoints"),e="start",o={x:t.start.x,y:t.start.y},r={x:t.end.x,y:t.end.y}):"start"===a.curveControls.state?"settingPoints"===n?r={x:t.end.x,y:t.end.y}:(l("settingPoints"),e="point1",s={x:t.end.x,y:t.end.y}):"point1"===a.curveControls.state?"settingPoints"===n?s={x:t.end.x,y:t.end.y}:(l("settingPoints"),e="point2",i={x:t.end.x,y:t.end.y}):"point2"===a.curveControls.state&&(i={x:t.end.x,y:t.end.y}),a.setCurveControls({...a.curveControls,state:e,start:o,end:r,controlPoint1:s,controlPoint2:i})}else"Curve"===a.subTool.shape&&"cancel"===n&&a.setCurveControls({state:"none",start:{x:-1,y:-1},end:{x:-1,y:-1},controlPoint1:{x:-1,y:-1},controlPoint2:{x:-1,y:-1}});"confirm"===n&&(s(e,t,a,!1),"Curve"===a.subTool.shape&&a.setCurveControls({state:"none",start:{x:-1,y:-1},end:{x:-1,y:-1},controlPoint1:{x:-1,y:-1},controlPoint2:{x:-1,y:-1}}),l("finished"),o({...t,start:{x:0,y:0},end:{x:0,y:0}}))}},c=(e,t,o,a)=>{if(null===e)t({File:{New:{action:"New",keybind:"Alt+N",disabled:!1},Open:{action:"Open",keybind:"Alt+O",disabled:!1},Download:{action:"Save",keybind:"Ctrl+Alt+S",disabled:!1},"Download As":{action:"Save As",keybind:"Ctrl+Alt+Shift+S",disabled:!1},"Change Name":{action:"Change Name",keybind:"F2",disabled:!1},LineBreak1:{},Close:{action:"Close",keybind:"Alt+Shift+F4",disabled:!1}},Edit:{Undo:{action:"Undo",keybind:"Ctrl+Z",disabled:!1},Redo:{action:"Redo",keybind:"Ctrl+Y",disabled:!1}},View:{"Zoom In":{action:"Zoom In",keybind:"Alt++",disabled:!1},"Zoom Out":{action:"Zoom Out",keybind:"Alt+-",disabled:!1},"Zoom Reset":{action:"Zoom Reset",keybind:"Alt+0",disabled:!0},LineBreak1:{},"Tool Bar":{action:"toolBar",checkbox:!0,disabled:!1},"Content Bar":{action:"contentBar",checkbox:!0,disabled:!1},"Bottom Bar":{action:"bottomNavBar",checkbox:!0,disabled:!1},"Top Bar":{action:"topNavBar",checkbox:!0,disabled:!1}}});else{let n={...e};switch(a){case"history":n={...n,Edit:{...n.Edit,Undo:{...n.Edit.Undo,disabled:!o.history.canUndo},Redo:{...n.Edit.Redo,disabled:!o.history.canRedo}}};break;case"view":n={...n,View:{...n.View,"Tool Bar":{...n.View["Tool Bar"],checkbox:o.view.toolBar},"Content Bar":{...n.View["Content Bar"],checkbox:o.view.contentBar},"Bottom Bar":{...n.View["Bottom Bar"],checkbox:o.view.bottomNavBar},"Top Bar":{...n.View["Top Bar"],checkbox:o.view.topNavBar}}};break;case"zoom":n={...n,View:{...n.View,"Zoom In":{...n.View["Zoom In"],disabled:4===o.zoom},"Zoom Out":{...n.View["Zoom Out"],disabled:.25===o.zoom},"Zoom Reset":{...n.View["Zoom Reset"],disabled:1===o.zoom}}}}t(n)}},d=(e,t,o,a,n,l,r,s,i,d)=>{let h={},u={};const x=e.canvas.height,p=e.canvas.width,g=(e,t,a)=>{o(e),d(t),r(a),c(n,l,u={history:{...t[s]}},"history")};switch(a){case"undo":(()=>{const e=i[s].id;h=t,document.getElementById(`drawCanvasLayer${e}`).getContext("2d").putImageData(t[e].data[t[e].lastIndex-1],0,0);const o=t[e].lastIndex-1>0;h[e].lastIndex--;let a=i;a[s]={...a[s],canUndo:o,canRedo:!0},g(h,a,!1)})();break;case"redo":(()=>{let e=i[s].id;h=t,document.getElementById(`drawCanvasLayer${e}`).getContext("2d").putImageData(t[e].data[t[e].lastIndex+1],0,0);const o=t[e].lastIndex+1<t[e].data.length-1;h[e].lastIndex++;let a=i;a[s]={...a[s],canUndo:!0,canRedo:o},g(h,a,!1)})();break;case"delete layer":default:break;case"duplicate layer":(()=>{let e=i[s].id;const o=document.getElementById(`drawCanvasLayer${e}`).getContext("2d"),a=t[e].data[t[e].lastIndex];o.putImageData(a,0,0)})();break;case"save":(()=>{let e=i[s].id,o=!1;h=t;let a=document.getElementById(`drawCanvasLayer${e}`).getContext("2d");h[e]?h[e].lastIndex===h[e].data.length-1?h[e]={data:[...h[e].data,a.getImageData(0,0,p,x)],lastIndex:h[e].data.length}:(h[e].data.splice(h[e].lastIndex+1,0,a.getImageData(0,0,p,x)),h[e].lastIndex++):(o=!0,h[e]={data:[a.getImageData(0,0,p,x)],lastIndex:0});let n=i;n[s]={...n[s],canUndo:!o,canRedo:!1},h[e].data.length>50&&(h[e].data.shift(),h[e].lastIndex--),g(h,n,!1)})();break;case"clear":h={0:{data:[e.getImageData(0,0,p,x)],lastIndex:0}},g(h,[{id:0,name:"Base",blending:"normal",filters:{},opacity:1,visible:!0,locked:!1,canUndo:!1,canRedo:!1}],!0)}},h=(e,t,o,a,n)=>{const l=e.canvas.height,r=e.canvas.width;function s(e){document.body.onfocus=()=>{e.value.length>0||(e.remove(),n(!1)),document.body.onfocus=null}}const i=()=>{let e=document.createElement("canvas"),o=e.getContext("2d");e.width=r,e.height=l,a.forEach((e=>{e.visible&&(o.globalCompositeOperation=e.blending,o.globalAlpha=e.opacity,e.filters&&(o.filter=function(e){if(!e)return"";let t="";return Object.keys(e).forEach((o=>{t+="hue-rotate"===o?`${o}(${e[o]}deg) `:"blur"===o?`${o}(${e[o]}px) `:"drop-shadow"===o?`${o}(${e[o][0]}px ${e[o][1]}px ${e[o][2]}px ${e[o][3]}) `:`${o}(${e[o]}%) `})),t}(e.filters)),o.drawImage(document.getElementById(`drawCanvasLayer${e.id}`),0,0))}));let n=document.createElement("a");n.setAttribute("download",t.name+".png");let s=e.getContext("2d").canvas.toDataURL("image/png").replace(/^data:image\/png/,"data:application/octet-stream");n.setAttribute("href",s),n.click()};switch(o){case"new":(()=>{const e=document.getElementById("drawCanvasLayer0").getContext("2d");t.useAlpha?e.fillStyle="#00000000":e.fillStyle="#FFFFFFFF",e.fillRect(0,0,r,l)})();break;case"save":i();break;case"open":(()=>{const e=document.createElement("input");e.type="file",e.accept="image/*",e.onchange=o=>{const a=o.target.files[0],l=new FileReader;l.onload=()=>{const o=new Image;o.src=l.result,o.onload=()=>{const l=document.getElementById("drawCanvasLayer0");l.width=o.width,l.height=o.height,t.setDimentions({width:o.width,height:o.height}),t.setName(a.name),l.getContext("2d").drawImage(o,0,0),n("Open Confirm"),e.remove()}},l.readAsDataURL(a)},e.click(),s(e)})();break;case"image":(()=>{const e=document.createElement("input");e.type="file",e.accept="image/*",e.onchange=o=>{const a=o.target.files[0],l=new FileReader;l.onload=()=>{const o=new Image;o.src=l.result,o.onload=()=>{const a=document.createElement("canvas");a.width=o.width,a.height=o.height;const l=a.getContext("2d");l.drawImage(o,0,0);const r=l.getImageData(0,0,o.width,o.height);t.setClipboard({data:r,state:"carry"}),t.setTool("Select"),n("clipping"),e.remove()}},l.readAsDataURL(a)},e.click(),s(e)})()}},u=e=>{let t={};const{canvas:o,ctx:a,context:l,params:r,action:s,setAction:u,appMenu:x,setAppMenu:p,appDialog:g,setAppDialog:b,contextMenu:m,canClose:y,setCanClose:v,isSelected:f,title:w,setTitle:C,currLayer:j,setCurrLayer:M,layers:P,setLayers:k}=e;switch(s){case"Startup":h(a,l,"new",P),d(a,l.history,l.setHistory,"clear",x,p,v,j,P,k),u(!1);break;case"New":((e,t,o)=>{e.setNewParams({...e.newParams,width:e.dimentions.width,height:e.dimentions.height,name:e.name,alpha:e.useAlpha});const a=(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("label",{htmlFor:"New title",children:"Name"}),(0,n.jsx)("br",{}),(0,n.jsx)("input",{id:"New title",type:"text",value:e.newParams.name,onChange:o=>{e.setNewParams({...e.newParams,name:o.target.value}),t("New")}}),(0,n.jsx)("br",{}),(0,n.jsx)("label",{htmlFor:"Width",children:"Width"}),(0,n.jsx)("br",{}),(0,n.jsx)("input",{id:"Width",type:"number",value:e.newParams.width,onChange:o=>{e.setNewParams({...e.newParams,width:o.target.value}),t("New")}}),(0,n.jsx)("br",{}),(0,n.jsx)("label",{htmlFor:"Height",children:"Height"}),(0,n.jsx)("br",{}),(0,n.jsx)("input",{id:"Height",type:"number",value:e.newParams.height,onChange:o=>{e.setNewParams({...e.newParams,height:o.target.value}),t("New")}}),(0,n.jsx)("br",{}),(0,n.jsx)("label",{htmlFor:"Alpha",children:"Alpha"}),(0,n.jsx)("br",{}),(0,n.jsx)("input",{id:"Alpha",type:"checkbox",checked:e.newParams.alpha,onChange:o=>{e.setNewParams({...e.newParams,alpha:o.target.checked}),t("New")}}),(0,n.jsx)("br",{})]}),l={Confirm:()=>{e.setDimentions({height:e.newParams.height,width:e.newParams.width}),e.setName(e.newParams.name),e.setUseAlpha(e.newParams.alpha),t("New Confirm"),o(null)},Cancel:()=>{o(null),t("Cancel Dialog")}};o({title:"New File",info:a,actions:l})})(l,u,b),"carry"===l.clipboard.state&&"Select"===l.tool?u("clipping"):u(!1);break;case"New Confirm":b(null),h(a,l,"new",P,u),M(0),d(a,l.history,l.setHistory,"clear",x,p,v,j,P,k),l.setClipboard({data:{},state:"none"}),u(!1);break;case"Open":h(a,l,"open",P,u);break;case"Open Confirm":M(0),d(a,l.history,l.setHistory,"clear",x,p,v,j,P,k),l.setClipboard({data:{},state:"none"}),u(!1);break;case"Save":h(a,l,"save",P),"carry"===l.clipboard.state&&"Select"===l.tool?u("clipping"):u(!1);break;case"Save As":((e,t,o)=>{const a=(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("label",{htmlFor:"New Name",children:"Name"}),(0,n.jsx)("br",{}),(0,n.jsx)("input",{id:"New name",type:"text",value:e.name,onChange:o=>{e.setName(o.target.value),t("Change Name")}}),(0,n.jsx)("br",{})]}),l={Confirm:()=>{t("Save"),o(null)},Cancel:()=>{o(null),t("Cancel Dialog")}};o({title:"Download As",info:a,actions:l})})(l,u,b),"carry"===l.clipboard.state&&"Select"===l.tool?u("clipping"):u(!1);break;case"Change Name":((e,t,o)=>{const a=(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("label",{htmlFor:"New title",children:"Name"}),(0,n.jsx)("br",{}),(0,n.jsx)("input",{id:"New title",type:"text",value:e.name,onChange:o=>{e.setName(o.target.value),t("Change Name")}}),(0,n.jsx)("br",{})]}),l={Confirm:()=>{t("Change Name Confirm"),o(null)},Cancel:()=>{o(null),t("Cancel Dialog")}};o({title:"Change Name",info:a,actions:l})})(l,u,b),"carry"===l.clipboard.state&&"Select"===l.tool?u("clipping"):u(!1);break;case"Change Name Confirm":C(l.name),b(null),"carry"===l.clipboard.state&&"Select"===l.tool?u("clipping"):u(!1);break;case"Image":h(a,l,"image",P,u);break;case"Undo":d(a,l.history,l.setHistory,"undo",x,p,v,j,P,k),"carry"===l.clipboard.state&&"Select"===l.tool?u("clipping"):u(!1);break;case"Redo":d(a,l.history,l.setHistory,"redo",x,p,v,j,P,k),"carry"===l.clipboard.state&&"Select"===l.tool?u("clipping"):u(!1);break;case"New Layer":d(a,l.history,l.setHistory,"save",x,p,v,j,P,k),"carry"===l.clipboard.state&&"Select"===l.tool?u("clipping"):u(!1);break;case"Delete Layer":d(a,l.history,l.setHistory,"delete layer",x,p,v,j,P,k),"carry"===l.clipboard.state&&"Select"===l.tool?u("clipping"):u(!1);break;case"Duplicate Layer":d(a,l.history,l.setHistory,"duplicate layer",x,p,v,j,P,k),"carry"===l.clipboard.state&&"Select"===l.tool?u("clipping"):u(!1);break;case"Zoom In":l.zoom<4&&(l.zoom<1?(l.setZoom(l.zoom+.25),t={zoom:l.zoom+.25}):(l.setZoom(l.zoom+1),t={zoom:l.zoom+1}),c(x,p,t,"zoom")),"carry"===l.clipboard.state&&"Select"===l.tool?u("clipping"):u(!1);break;case"Zoom Out":l.zoom>.25&&(l.zoom<=1?(l.setZoom(l.zoom-.25),t={zoom:l.zoom-.25}):(l.setZoom(l.zoom-1),t={zoom:l.zoom-1}),c(x,p,t,"zoom")),"carry"===l.clipboard.state&&"Select"===l.tool?u("clipping"):u(!1);break;case"Zoom Reset":l.setZoom(1),t={zoom:1},c(x,p,t,"zoom"),"carry"===l.clipboard.state&&"Select"===l.tool?u("clipping"):u(!1);break;case"Zoom Min":t={zoom:.25},c(x,p,t,"zoom"),u(!1);break;case"Zoom Max":t={zoom:4},c(x,p,t,"zoom"),u(!1);break;case"Zoom Default":t={zoom:1},c(x,p,t,"zoom"),u(!1);break;case"Zoom Change":t={zoom:2},c(x,p,t,"zoom"),u(!1);break;case"Cut":case"Copy":case"Paste":case"Select All":case"Select Clear":u(!1);break;case"finished":d(a,l.history,l.setHistory,"save",x,p,v,j,P,k),u(!1);break;case"drawing":l.cursor.down&&!P[j].locked?i(o,l.cursor,l.setCursor,r,s,u):u("finished");break;case"spraying":l.cursor.down&&!P[j].locked?setTimeout((()=>{u("drawing")}),100):u("finished");break;case"settingPoints":l.cursor.down?i(o,l.cursor,l.setCursor,r,s,u):u(!1);break;case"cancel":case"clipping":case"confirm":i(o,l.cursor,l.setCursor,r,s,u);break;case!1:l.cursor.down&&!P[j].locked&&i(o,l.cursor,l.setCursor,r,s,u);break;case"topNavBar":l.setView({...l.view,topNavBar:!l.view.topNavBar}),t={view:{...l.view,topNavBar:!l.view.topNavBar}},c(x,p,t,"view"),"carry"===l.clipboard.state&&"Select"===l.tool?u("clipping"):u(!1);break;case"contentBar":l.setView({...l.view,contentBar:!l.view.contentBar}),t={view:{...l.view,contentBar:!l.view.contentBar}},c(x,p,t,"view"),"carry"===l.clipboard.state&&"Select"===l.tool?u("clipping"):u(!1);break;case"bottomNavBar":l.setView({...l.view,bottomNavBar:!l.view.bottomNavBar}),t={view:{...l.view,bottomNavBar:!l.view.bottomNavBar}},c(x,p,t,"view"),"carry"===l.clipboard.state&&"Select"===l.tool?u("clipping"):u(!1);break;case"toolBar":l.setView({...l.view,toolBar:!l.view.toolBar}),t={view:{...l.view,toolBar:!l.view.toolBar}},c(x,p,t,"view"),"carry"===l.clipboard.state&&"Select"===l.tool?u("clipping"):u(!1);break;case"Close":y||((e,t,o)=>{o({title:"Warning",info:"Do you want to download the file before closing?",actions:{Save:()=>{t("Save and Close"),o(null)},Close:()=>{e(!0),o(null)},Cancel:()=>{o(null),t("Cancel Dialog")}}})})(v,u,b);break;case"Save and Close":h(a,l,"save"),v(!0),u("Close");break;case"Cancel Dialog":"carry"===l.clipboard.state&&"Select"===l.tool?u("clipping"):u(!1);break;default:u(!1)}};function x(e){let{action:t,setAction:o,appMenu:r,setAppMenu:s,appDialog:i,setAppDialog:c,contextMenu:d,canClose:h,setCanClose:x,title:p,setTitle:g}=e;const b=(0,a.useContext)(l),m=b.layers,y=b.setLayers,v=b.currLayer,f=b.setCurrLayer,w={tool:b.tool,brushPoints:b.brushPoints,setBrushPoints:b.setBrushPoints,subTool:b.subTool,curveControls:b.curveControls,setCurveControls:b.setCurveControls,size:b.size,selectedColor:b.color.selected,color1:b.color[1],setColor1:e=>b.setColor({...b.color,1:e,selected:e}),color2:b.color[2],setColor2:e=>b.setColor({...b.color,2:e,selected:e}),text:b.text,setText:b.setText,clipboard:b.clipboard,setClipboard:b.setClipboard};function C(e){if(!e)return"";let t="";return Object.keys(e).forEach((o=>{t+="hue-rotate"===o?`${o}(-${e[o]}deg) `:"blur"===o?`${o}(${e[o]}px) `:"drop-shadow"===o?`${o}(${e[o][0]}px ${e[o][1]}px ${e[o][2]}px ${e[o][3]}) `:`${o}(${e[o]}%) `})),t}return(0,a.useEffect)((()=>{if(void 0===m[v].id)return;let e=document.getElementById(`drawCanvasLayer${m[v].id}`),a=e.getContext("2d",{willReadFrequently:!0});u({canvas:e,ctx:a,params:w,action:t,setAction:o,context:b,appMenu:r,setAppMenu:s,appDialog:i,setAppDialog:c,contextMenu:d,canClose:h,setCanClose:x,title:p,setTitle:g,currLayer:v,setCurrLayer:f,layers:m,setLayers:y})}),[b.cursor,t]),(0,a.useEffect)((()=>{let e=-1*(b.dimentions.width/2-b.zoom*b.dimentions.width/2)/b.zoom,t=-1*(b.dimentions.height/2-b.zoom*b.dimentions.height/2)/b.zoom;document.getElementById("drawDocCheckersBackground").style.transform=`scale(${b.zoom}) translate(${e}px,${t}px)`,document.getElementById("previewCanvas").style.transform=`scale(${b.zoom}) translate(${e}px,${t}px)`,document.getElementById("interfaceCanvas").style.transform=`scale(${b.zoom}) translate(${e}px,${t}px)`;const o=document.getElementsByClassName("drawCanvasLayer");if(o.length>0)for(let a=0;a<o.length;a++)o[a].style.transform=`scale(${b.zoom}) translate(${e}px,${t}px)`}),[b.zoom,b.cursor]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("img",{id:"drawDocCheckersBackground",className:"drawDocCheckersBackground",height:b.dimentions.height,width:b.dimentions.width}),m.length>0&&m.map(((e,t)=>(0,n.jsx)("canvas",{id:`drawCanvasLayer${e.id}`,className:"drawCanvasLayer",style:{display:e.visible?"block":"none",filter:C(e.filters),opacity:e.opacity,mixBlendMode:e.blending,zIndex:t},height:b.dimentions.height,width:b.dimentions.width},e.id)))]})}function p(){const e=(0,a.useContext)(l),t=(0,a.useRef)(null),o=e.cursor,r=e.tool,i=e.brushPoints,c=e.setBrushPoints,d=e.subTool,h=e.curveControls,u=e.setCurveControls,x=e.size,p=e.color.selected,g=e.color[1],b=e.color[2],m=e.text,y=e.setText,v=e.clipboard,f=e.setClipboard,w=e.layers,C=e.currLayer,j={tool:r,subTool:d,brushPoints:i,setBrushPoints:c,curveControls:h,setCurveControls:u,size:x,selectedColor:p,color1:g,setColor1:t=>e.setColor({...e.color,1:t}),color2:b,setColor2:t=>e.setColor({...e.color,2:t}),text:m,setText:y,clipboard:v,setClipboard:f};return(0,a.useEffect)((()=>{w[C].locked||s(t.current,o,j,!0)}),[o,j]),(0,n.jsx)("canvas",{ref:t,style:{display:w[C].locked?"none":"block",color:j.selectedColor,zIndex:C},id:"previewCanvas",height:e.dimentions.height,width:e.dimentions.width})}function g(){const e=(0,a.useContext)(l),t=e.cursor,o=e.setCursor,r=e.zoom,s=e.tool,i=e.subTool,c=e.setSubTool,d=e.layers,h=e.currLayer,u=e.clipboard,x=e.curveControls,p=e.setCurveControls,[g,b]=(0,a.useState)({left:"0px",top:"0px",height:"0px",width:"0px",canUsePointer:!0}),[m,y]=(0,a.useState)({left:"0px",top:"0px",diameter:"0px"}),[v,f]=(0,a.useState)({left:"0px",top:"0px",width:"0px",height:"0px"}),[w,C]=(0,a.useState)([0,0,!0]),[j,M]=(0,a.useState)([0,0,0,0]),[P,k]=(0,a.useState)([0,0,0]),[S,T]=(0,a.useState)([0,0,!1]),D=e=>{let t,o,a=!1;if(0===e.button?0!==e.clientX&&0!==e.clientY&&(t=e.clientX,o=e.clientY,a=!0):0!==e.touches[0].clientX&&0!==e.touches[0].clientY&&(t=e.touches[0].clientX,o=e.touches[0].clientY,a=!0),a){let e=document.getElementById("interfaceCanvas"),a=e.getContext("2d",{alpha:!0}),n=e.getBoundingClientRect();const l=a.canvas.width/n.width,r=a.canvas.height/n.height;return t=(t-n.left)*l,o=(o-n.top)*r,[t,o,!0]}return[0,0,!1]},I=(e,a)=>{e.stopPropagation(),o({...t,selecting:!0});const n=D(e);let l=0,r=0;!1!==n[2]&&(-1!==a.indexOf("N")?r=n[1]-Math.min(t.start.y,t.end.y):-1!==a.indexOf("S")&&(r=n[1]-Math.max(t.start.y,t.end.y)),-1!==a.indexOf("W")?l=n[0]-Math.min(t.start.x,t.end.x):-1!==a.indexOf("E")&&(l=n[0]-Math.max(t.start.x,t.end.x)),C([l,r]))};function B(e,o,a){let n=!1,l=!1;t.start.x>t.end.x&&(n=!0),t.start.y>t.end.y&&(l=!0);let r=t.start.x,s=t.start.y,i=t.end.x,c=t.end.y;return-1!==a.indexOf("N")?l?c=o[1]-w[1]:s=o[1]-w[1]:-1!==a.indexOf("S")&&(l?s=o[1]-w[1]:c=o[1]-w[1]),-1!==a.indexOf("E")?n?r=o[0]-w[0]:i=o[0]-w[0]:-1!==a.indexOf("W")&&(n?i=o[0]-w[0]:r=o[0]-w[0]),[r,s,i,c]}const L=(e,a)=>{e.preventDefault(),e.stopPropagation();const n=D(e);if(!1===n[2])return;const l=B(0,n,a);o({...t,start:{x:l[0],y:l[1]},end:{x:l[2],y:l[3]}})},N=(e,a)=>{e.preventDefault(),e.stopPropagation();const n=D(e);if(!1===n[2])return;const l=B(0,n,a);o({...t,start:{x:l[0],y:l[1]},end:{x:l[2],y:l[3]},selecting:!1})},E=e=>{e.stopPropagation(),o({...t,selecting:!0});const a=D(e);if(!1===a[2])return;if("drawDocSelectionBox"!==e.target.id&&"drawDocSelectionEllipse"!==e.target.id&&"drawDocSelectionCircle"!==e.target.id&&"drawDocSelectionBoxDragPivot"!==e.target.id)return;let n=0,l=0,r=0,s=0;n=a[0]-t.start.x,l=a[1]-t.start.y,r=a[0]-t.end.x,s=a[1]-t.end.y,M([n,l,r,s])},A=e=>{e.preventDefault(),e.stopPropagation();const a=D(e);!1!==a[2]&&("drawDocSelectionBox"!==e.target.id&&"drawDocSelectionEllipse"!==e.target.id&&"drawDocSelectionCircle"!==e.target.id&&"drawDocSelectionBoxDragPivot"!==e.target.id||o({...t,start:{x:a[0]-j[0],y:a[1]-j[1]},end:{x:a[0]-j[2],y:a[1]-j[3]}}))},z=e=>{e.preventDefault(),e.stopPropagation();const a=D(e);!1!==a[2]&&("drawDocSelectionBox"!==e.target.id&&"drawDocSelectionEllipse"!==e.target.id&&"drawDocSelectionCircle"!==e.target.id&&"drawDocSelectionBoxDragPivot"!==e.target.id||o({...t,start:{x:a[0]-j[0],y:a[1]-j[1]},end:{x:a[0]-j[2],y:a[1]-j[3]},selecting:!1}))},R=e=>{e.preventDefault();const t=D(e);if(!1===t[2])return;let o=Number(m.top.slice(0,-2)),a=Number(m.left.slice(0,-2)),n=Number(m.diameter.slice(0,-2)),l=a+n/2+P[3],r=o+n/2+P[4],s=l>t[0]?l-t[0]:t[0]-l,d=r>t[1]?r-t[1]:t[1]-r,h=Math.sqrt(Math.pow(s,2)+Math.pow(d,2)),u=Math.acos((Math.pow(s,2)+Math.pow(h,2)-Math.pow(d,2))/(2*s*h))/(Math.PI/180),x=0;t[0]>l&&t[1]<r?x=90-u:t[0]>l&&t[1]>r?x=90+u:t[0]<l&&t[1]>r?x=270-u:t[0]<l&&t[1]<r&&(x=270+u),c({...i,angle:x})},$=(e,a)=>{e.stopPropagation(),o({...t,selecting:!0});const n=D(e);if(!1===n[2])return;if("drawDocSelectionPivotPoint"!==e.target.className)return;let l=0,r=0,s=0,i=0;switch(a){case 0:s=t.start.x,i=t.start.y;break;case 1:s=x.controlPoint1.x,i=x.controlPoint1.y;break;case 2:s=x.controlPoint2.x,i=x.controlPoint2.y;break;case 3:s=t.end.x,i=t.end.y}l=n[0]-s,r=n[1]-i,T([l,r])},F=(e,a)=>{e.preventDefault(),e.stopPropagation();const n=D(e);if(!1!==n[2]&&"drawDocSelectionPivotPoint"===e.target.className)switch(a){case 0:o({...t,start:{x:n[0]-S[0],y:n[1]-S[1]}}),"Curve"===i.shape&&p({...x,start:{x:n[0]-S[0],y:n[1]-S[1]}});break;case 1:p({...x,controlPoint1:{x:n[0]-S[0],y:n[1]-S[1]}});break;case 2:p({...x,controlPoint2:{x:n[0]-S[0],y:n[1]-S[1]}});break;case 3:o({...t,end:{x:n[0]-S[0],y:n[1]-S[1]}}),"Curve"===i.shape&&p({...x,end:{x:n[0]-S[0],y:n[1]-S[1]}})}},U=(e,a)=>{e.preventDefault(),e.stopPropagation();const n=D(e);if(!1!==n[2]&&"drawDocSelectionPivotPoint"===e.target.className)switch(a){case 0:o({...t,start:{x:n[0]-S[0],y:n[1]-S[1]},selecting:!1}),"Curve"===i.shape&&p({...x,start:{x:n[0]-S[0],y:n[1]-S[1]}});break;case 1:o({...t,selecting:!1}),p({...x,controlPoint1:{x:n[0]-S[0],y:n[1]-S[1]}});break;case 2:o({...t,selecting:!1}),p({...x,controlPoint2:{x:n[0]-S[0],y:n[1]-S[1]}});break;case 3:o({...t,end:{x:n[0]-S[0],y:n[1]-S[1]},selecting:!1}),"Curve"===i.shape&&p({...x,end:{x:n[0]-S[0],y:n[1]-S[1]}})}};return(0,a.useEffect)((()=>{if("Select"!==s||"carry"!==u.state){let e=Math.min(t.start.x,t.end.x),o=Math.max(t.start.x,t.end.x),a=Math.min(t.start.y,t.end.y),n=Math.max(t.start.y,t.end.y)-a,l=o-e;b({...g,left:Math.floor(e*r)+"px",top:Math.floor(a*r)+"px",width:Math.floor(l*r)+"px",height:Math.floor(n*r)+"px"});let s=e+Math.floor(l/2),i=a+Math.floor(n/2),c=Math.min(l,n);y({...m,left:Math.floor((s-c/2)*r)+"px",top:Math.floor((i-c/2)*r)+"px",diameter:Math.floor(c*r)+"px"}),f({...v,left:Math.floor(e*r)+"px",top:Math.floor(a*r)+"px",width:Math.floor(l*r)+"px",height:Math.floor(n*r)+"px"})}else b({...g,left:Math.floor(t.end.x*r)+"px",top:Math.floor(t.end.y*r)+"px",width:Math.floor(u.data.width*r)+"px",height:Math.floor(u.data.height*r)+"px"})}),[t,r,s,u.state]),d[h].locked?null:(0,n.jsxs)(n.Fragment,{children:[("Select"===s||"Shape"===s&&"Curve"!==i.shape&&"Line"!==i.shape||"Text"===s)&&(0,n.jsxs)("div",{id:"drawDocSelectionBox",style:{top:g.top,left:g.left,width:g.width,height:g.height,pointerEvents:t.down?"none":"auto",zIndex:d.length+2},draggable:!0,onDragStart:e=>{t.down||E(e)},onDrag:e=>{t.down||A(e)},onDragEnd:e=>{t.down||z(e)},children:["Text"===s&&(0,n.jsx)("div",{id:"drawDocSelectionBoxDragPivot"}),("Select"!==s||"carry"!==u.state)&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{id:"drawDocSelectionBoxNW",draggable:!0,onDragStart:e=>{t.down||I(e,"NW")},onDrag:e=>{t.down||L(e,"NW")},onDragEnd:e=>{t.down||N(e,"NW")}}),(0,n.jsx)("div",{id:"drawDocSelectionBoxN",draggable:!0,onDragStart:e=>{t.down||I(e,"N")},onDrag:e=>{t.down||L(e,"N")},onDragEnd:e=>{t.down||N(e,"N")}}),(0,n.jsx)("div",{id:"drawDocSelectionBoxNE",draggable:!0,onDragStart:e=>{t.down||I(e,"NE")},onDrag:e=>{t.down||L(e,"NE")},onDragEnd:e=>{t.down||N(e,"NE")}}),(0,n.jsx)("div",{id:"drawDocSelectionBoxE",draggable:!0,onDragStart:e=>{t.down||I(e,"E")},onDrag:e=>{t.down||L(e,"E")},onDragEnd:e=>{t.down||N(e,"E")}}),(0,n.jsx)("div",{id:"drawDocSelectionBoxSE",draggable:!0,onDragStart:e=>{t.down||I(e,"SE")},onDrag:e=>{t.down||L(e,"SE")},onDragEnd:e=>{t.down||N(e,"SE")}}),(0,n.jsx)("div",{id:"drawDocSelectionBoxS",draggable:!0,onDragStart:e=>{t.down||I(e,"S")},onDrag:e=>{t.down||L(e,"S")},onDragEnd:e=>{t.down||N(e,"S")}}),(0,n.jsx)("div",{id:"drawDocSelectionBoxSW",draggable:!0,onDragStart:e=>{t.down||I(e,"SW")},onDrag:e=>{t.down||L(e,"SW")},onDragEnd:e=>{t.down||N(e,"SW")}}),(0,n.jsx)("div",{id:"drawDocSelectionBoxW",draggable:!0,onDragStart:e=>{t.down||I(e,"W")},onDrag:e=>{t.down||L(e,"W")},onDragEnd:e=>{t.down||N(e,"W")}})]})]}),"Shape"===s&&"Line"!==i.shape&&"Curve"!==i.shape&&i.stretch&&(0,n.jsx)("div",{id:"drawDocSelectionEllipse",style:{top:v.top,left:v.left,width:v.width,height:v.height,rotate:i.angle+"deg",zIndex:d.length+2},draggable:!0,onDragStart:e=>{t.down||E(e)},onDrag:e=>{t.down||A(e)},onDragEnd:e=>{t.down||z(e)}}),"Shape"===s&&"Line"!==i.shape&&"Curve"!==i.shape&&(0,n.jsx)("div",{id:"drawDocSelectionCircle",style:{top:m.top,left:m.left,width:m.diameter,height:m.diameter,rotate:i.angle+"deg",zIndex:d.length+2},draggable:!0,onDragStart:e=>{t.down||E(e)},onDrag:e=>{t.down||A(e)},onDragEnd:e=>{t.down||z(e)},children:(0,n.jsx)("div",{id:"drawDocSelectionCirclePoint",draggable:!0,onDragStart:e=>{t.down||(e=>{o({...t,selecting:!0});const a=D(e),n=document.getElementById("previewCanvas").getBoundingClientRect();!1!==a[2]&&k([a[0],a[1],i.angle,n.left,n.top])})(e)},onDrag:e=>{t.down||R(e)},onDragEnd:e=>{t.down||(e=>{R(e),o({...t,selecting:!1})})(e)}})}),"Text"===s&&!t.down&&(0,n.jsx)("textarea",{id:"drawDocSelectionBoxText",style:{top:g.top,left:g.left,width:g.width,height:g.height,caretColor:e.color.selected,fontSize:e.size*e.zoom+"px",fontFamily:e.text.fontFamily,lineHeight:e.text.lineHeight,zIndex:d.length+2},spellCheck:!1,value:e.text.text,onChange:t=>e.setText({...e.text,text:t.target.value})}),"Shape"===s&&"Curve"===i.shape&&(0,n.jsxs)(n.Fragment,{children:[-1===x.controlPoint1.x&&-1===x.controlPoint2.x&&(0,n.jsx)("div",{id:"drawDocSelectionPivotLineStartEnd",className:"drawDocSelectionPivotLine",style:{display:"block",top:Math.floor(x.start.y*r)+"px",left:Math.floor(x.start.x*r)+"px",width:Math.floor(Math.sqrt(Math.pow(x.end.x-x.start.x,2)+Math.pow(x.end.y-x.start.y,2))*r)+"px",rotate:Math.floor(180*Math.atan2(x.end.y-x.start.y,x.end.x-x.start.x)/Math.PI)+"deg",zIndex:d.length+2}}),-1!==x.controlPoint1.x&&-1===x.controlPoint2.x&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{id:"drawDocSelectionPivotLineStart1",className:"drawDocSelectionPivotLine",style:{display:"block",top:Math.floor(x.start.y*r)+"px",left:Math.floor(x.start.x*r)+"px",width:Math.floor(Math.sqrt(Math.pow(x.controlPoint1.x-x.start.x,2)+Math.pow(x.controlPoint1.y-x.start.y,2))*r)+"px",rotate:Math.floor(180*Math.atan2(x.controlPoint1.y-x.start.y,x.controlPoint1.x-x.start.x)/Math.PI)+"deg",zIndex:d.length+2}}),(0,n.jsx)("div",{id:"drawDocSelectionPivotLine1End",className:"drawDocSelectionPivotLine",style:{display:"block",top:Math.floor(x.controlPoint1.y*r)+"px",left:Math.floor(x.controlPoint1.x*r)+"px",width:Math.floor(Math.sqrt(Math.pow(x.end.x-x.controlPoint1.x,2)+Math.pow(x.end.y-x.controlPoint1.y,2))*r)+"px",rotate:Math.floor(180*Math.atan2(x.end.y-x.controlPoint1.y,x.end.x-x.controlPoint1.x)/Math.PI)+"deg",zIndex:d.length+2}})]}),-1!==x.controlPoint1.x&&-1!==x.controlPoint2.x&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{id:"drawDocSelectionPivotLineStart1",className:"drawDocSelectionPivotLine",style:{display:"block",top:Math.floor(x.start.y*r)+"px",left:Math.floor(x.start.x*r)+"px",width:Math.floor(Math.sqrt(Math.pow(x.controlPoint1.x-x.start.x,2)+Math.pow(x.controlPoint1.y-x.start.y,2))*r)+"px",rotate:Math.floor(180*Math.atan2(x.controlPoint1.y-x.start.y,x.controlPoint1.x-x.start.x)/Math.PI)+"deg",zIndex:d.length+2}}),(0,n.jsx)("div",{id:"drawDocSelectionPivotLine12",className:"drawDocSelectionPivotLine",style:{display:"block",top:Math.floor(x.controlPoint1.y*r)+"px",left:Math.floor(x.controlPoint1.x*r)+"px",width:Math.floor(Math.sqrt(Math.pow(x.controlPoint2.x-x.controlPoint1.x,2)+Math.pow(x.controlPoint2.y-x.controlPoint1.y,2))*r)+"px",rotate:Math.floor(180*Math.atan2(x.controlPoint2.y-x.controlPoint1.y,x.controlPoint2.x-x.controlPoint1.x)/Math.PI)+"deg",zIndex:d.length+2}}),(0,n.jsx)("div",{id:"drawDocSelectionPivotLine2End",className:"drawDocSelectionPivotLine",style:{display:"block",top:Math.floor(x.controlPoint2.y*r)+"px",left:Math.floor(x.controlPoint2.x*r)+"px",width:Math.floor(Math.sqrt(Math.pow(x.end.x-x.controlPoint2.x,2)+Math.pow(x.end.y-x.controlPoint2.y,2))*r)+"px",rotate:Math.floor(180*Math.atan2(x.end.y-x.controlPoint2.y,x.end.x-x.controlPoint2.x)/Math.PI)+"deg",zIndex:d.length+2}})]}),(0,n.jsx)("div",{id:"drawDocSelectionPivotPoint1",className:"drawDocSelectionPivotPoint",style:{display:x.controlPoint1.x>-1&&!t.down?"block":"none",top:Math.floor(x.controlPoint1.y*r)+"px",left:Math.floor(x.controlPoint1.x*r)+"px",zIndex:d.length+2},draggable:!0,onDragStart:e=>{t.down||$(e,1)},onDrag:e=>{t.down||F(e,1)},onDragEnd:e=>{t.down||U(e,1)}}),(0,n.jsx)("div",{id:"drawDocSelectionPivotPoint2",className:"drawDocSelectionPivotPoint",style:{display:x.controlPoint2.x>-1&&!t.down?"block":"none",top:Math.floor(x.controlPoint2.y*r)+"px",left:Math.floor(x.controlPoint2.x*r)+"px",zIndex:d.length+2},draggable:!0,onDragStart:e=>{t.down||$(e,2)},onDrag:e=>{t.down||F(e,2)},onDragEnd:e=>{t.down||U(e,2)}})]}),"Shape"===s&&("Line"===i.shape||"Curve"===i.shape)&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{id:"drawDocSelectionPivotStartPoint",className:"drawDocSelectionPivotPoint",style:{display:t.down?"none":"block",top:"Curve"===i.shape?Math.floor(x.start.y*r)+"px":Math.floor(t.start.y*r)+"px",left:"Curve"===i.shape?Math.floor(x.start.x*r)+"px":Math.floor(t.start.x*r)+"px",zIndex:d.length+2},draggable:!0,onDragStart:e=>{t.down||$(e,0)},onDrag:e=>{t.down||F(e,0)},onDragEnd:e=>{t.down||U(e,0)}}),(0,n.jsx)("div",{id:"drawDocSelectionPivotEndPoint",className:"drawDocSelectionPivotPoint",style:{display:t.down?"none":"block",top:"Curve"===i.shape?Math.floor(x.end.y*r)+"px":Math.floor(t.end.y*r)+"px",left:"Curve"===i.shape?Math.floor(x.end.x*r)+"px":Math.floor(t.end.x*r)+"px",zIndex:d.length+2},draggable:!0,onDragStart:e=>{t.down||$(e,3)},onDrag:e=>{t.down||F(e,3)},onDragEnd:e=>{t.down||U(e,3)}})]})]})}var b=o(6833),m=o(9106),y=o(7196),v=o(3156),f=o(9804),w=o(5394),C=o(9342);function j(e){const t=e.action,o=e.setAction,r=(e.contextMenu,e.appMenu),s=e.setAppMenu,i=(0,a.useContext)(l),d=i.history,h=i.setHistory,u=i.currLayer,x=i.setCurrLayer,p=i.layers,g=i.setLayers,b=i.lastLayer,j=i.setLastLayer,[M,P]=(0,a.useState)([]),[k,S]=(0,a.useState)(-1),[T,D]=(0,a.useState)(-1),[I,B]=(0,a.useState)(-1),L=[["blur","length"],["brightness","percentage"],["contrast","percentage"],["grayscale","percentage"],["hue-rotate","angle"],["invert","percentage"],["saturate","percentage"],["sepia","percentage"],["drop-shadow","shadow"]];function N(e){let t=e.replace(/-/g," ");return t=t.replace(/\b([a-z\xc1-\xfa]{3,})/g,(e=>e.charAt(0).toUpperCase()+e.slice(1))),t}const E=e=>{let t;x(e),c(r,s,t={history:{...p[e]}},"history")};(0,a.useEffect)((()=>{if(-1!==k){const e=document.getElementById(`drawDocLayerNameInput${k}`);return e.focus(),e.select(),e.addEventListener("blur",(()=>S(-1))),e.addEventListener("keydown",(e=>{"Enter"===e.key&&S(-1)})),()=>{e.removeEventListener("blur",(()=>S(-1))),e.removeEventListener("keydown",(e=>{"Enter"===e.key&&S(-1)}))}}}),[k]);const A=(e,t,o,a)=>{const n=[...p];"drop-shadow"!==t?n[e].filters[t]=o:n[e].filters[t][a]=o,g(n)},z=(e,t)=>{e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="move",B(t)},R=(e,t)=>{e.preventDefault(),e.stopPropagation();let o=[];const a=p[T];if(T<1||T===t)return B(-1),void D(-1);if(0===t)o=[p[0],a,...p.filter(((e,t)=>t!==T&&0!==t))];else if(t===p.length)o=[...p.filter(((e,t)=>t!==T)),a];else if(t===p.length-1){const e=p[t];o=[...p.filter(((e,o)=>o<t&&o!==T)),a,e]}else{const e=p[t];o=[...p.filter(((e,o)=>o<t&&o!==T)),t<T?a:e,t>T?a:e,...p.filter(((e,o)=>o>t&&o!==T))]}g(o),B(-1),D(-1)};return(0,a.useEffect)((()=>{p.length>0&&P(p.map((e=>((e,t)=>{const o=document.getElementById(e);return(t?o.getContext("2d",{alpha:!0}):o.getContext("2d",{alpha:!1})).canvas.toDataURL("image/png")})(`drawCanvasLayer${e.id}`,!0))))}),[d,p,t]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{id:"drawDocLayersWindowNav",children:[(0,n.jsxs)("div",{id:"drawDocLayersWindowHeaderMixes",children:[(0,n.jsx)("select",{id:"drawDocBlendingSelect",title:"Change Blending","aria-label":"Change Blending",onChange:e=>((e,t)=>{const o=[...p];o[e].blending=t,g(o)})(u,e.target.value),value:p[u].blending,disabled:p[u].locked||0===u,children:["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"].map(((e,t)=>(0,n.jsx)("option",{value:e,children:N(e)},t)))}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"drawDocOpacityInput",children:"Opacity:"}),(0,n.jsx)("input",{id:"drawDocOpacityInput",type:"number",min:"0",max:"1",step:"0.01",value:p[u].opacity,onChange:e=>((e,t)=>{const o=[...p];o[e].opacity=t,g(o)})(u,e.target.value),disabled:p[u].locked||0===u})]})]}),(0,n.jsxs)("div",{id:"drawDocLayersWindowHeaderOptions",children:[(0,n.jsx)("button",{title:"Duplicate Layer","aria-label":"Duplicate Layer",onClick:()=>(e=>{let t=b+1;const a={id:t,name:`Dupe ${p[e].name}`,blending:p[e].blending,filters:p[e].filters,opacity:p[e].opacity,visible:!0,locked:p[e].locked,canUndo:p[e].canUndo,canRedo:p[e].canRedo};g([...p.slice(0,e+1),a,...p.slice(e+1)]),x(e+1),j(b+1);let n=d;n[t]=d[p[e].id],h(n),o("Duplicate Layer")})(u),children:(0,n.jsx)(w.oCv,{})}),(0,n.jsx)("button",{title:"Rename Layer","aria-label":"Rename Layer",disabled:0===u,onClick:()=>S(u),children:(0,n.jsx)(y.Ics,{})}),(0,n.jsx)("button",{title:p[u].locked?"Unlock Layer":"Lock Layer","aria-label":p[u].locked?"Unlock Layer":"Lock Layer",onClick:()=>(e=>{const t=[...p];t[e].locked=!t[e].locked,g(t)})(u),className:p[u].locked?"buttonActive":"",children:p[u].locked?(0,n.jsx)(C.BWK,{}):(0,n.jsx)(C.lg2,{})}),(0,n.jsx)("button",{title:"Delete Layer","aria-label":"Delete Layer",disabled:0===u||p[u].locked,onClick:()=>{return e=u,g(p.filter(((t,o)=>o!==e))),(e===u||u>p.length-2)&&x(0),void o("Delete Layer");var e},children:(0,n.jsx)(v.G02,{})})]})]}),(0,n.jsxs)("div",{id:"drawDocLayersWindow",onDragOver:e=>{z(e,p.length)},onDrop:e=>{R(e,p.length)},children:[p.map(((e,t)=>(0,n.jsxs)(a.Fragment,{children:[0!==t&&(0,n.jsx)("hr",{style:{display:I===t?"block":"none"}}),(0,n.jsxs)("div",{className:"drawDocLayersWindowLayer",draggable:0!==t,onDragStart:e=>D(t),onDrag:e=>e.preventDefault(),onDragOver:e=>{z(e,t)},onDrop:e=>{R(e,t)},style:{cursor:0===t?"default":"grab"},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("img",{src:M[t]?M[t]:"",className:"drawDocCheckersBackground",onClick:()=>E(t),draggable:0!==t}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("input",{type:"radio",value:t,checked:u===t,onChange:()=>E(t)}),(0,n.jsx)("span",{style:{textDecoration:t===u?"underline":"none",display:t===k?"none":"inline-block"},children:e.name}),(0,n.jsx)("input",{style:{display:t===k?"inline-block":"none"},id:`drawDocLayerNameInput${t}`,type:"text",value:e.name,onChange:e=>{((e,t)=>{const o=[...p];o[t].name=e.target.value,g(o)})(e,t)}})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("button",{title:"Toggle Visibility","aria-label":"Toggle Visibility",onClick:()=>(e=>{const t=[...p];t[e].visible=!t[e].visible,g(t)})(t),children:e.visible?(0,n.jsx)(y.yAb,{}):(0,n.jsx)(y.qRD,{})}),(0,n.jsx)("button",{title:"Undo Layer","aria-label":"Undo Layer",disabled:!e.canUndo||e.locked,onClick:()=>{x(t),o("Undo")},children:(0,n.jsx)(f.qHd,{})}),(0,n.jsx)("button",{title:"Redo Layer","aria-label":"Redo Layer",disabled:!e.canRedo||e.locked,onClick:()=>{x(t),o("Redo")},children:(0,n.jsx)(f.qQW,{})})]})]}),(0,n.jsxs)("div",{children:["Add Filter:",(0,n.jsxs)("select",{title:"Add filter","aria-label":"Add filter",value:"",onChange:e=>((e,t)=>{if(p[e].filters[t])return;const o=[...p];o[e].filters[t]="drop-shadow"!==t?0:[0,0,0,"hsla(0,0,0,0)"],g(o)})(t,e.target.value),disabled:e.locked||0===t,children:[(0,n.jsx)("option",{value:"",children:"Select"}),L.map(((e,t)=>(0,n.jsx)("option",{value:e[0],children:N(e[0])},t)))]})]})]}),(0,n.jsx)("div",{className:"drawDocLayersFilterList",children:e.filters&&Object.keys(e.filters).map((o=>(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{children:N(o)}),"length"===L.find((e=>e[0]===o))[1]&&(0,n.jsx)("div",{children:(0,n.jsxs)("div",{children:[(0,n.jsx)("input",{type:"number",min:"0",step:"1",value:e.filters[o],onChange:e=>A(t,o,e.target.value)}),"px"]})}),"percentage"===L.find((e=>e[0]===o))[1]&&(0,n.jsx)("div",{children:(0,n.jsxs)("div",{children:[(0,n.jsx)("input",{type:"number",min:"0",max:"100",step:"1",value:e.filters[o],onChange:e=>A(t,o,e.target.value)}),"%"]})}),"angle"===L.find((e=>e[0]===o))[1]&&(0,n.jsx)("div",{children:(0,n.jsxs)("div",{children:[(0,n.jsx)("input",{type:"number",min:"0",max:"359",step:"1",value:e.filters[o],onChange:e=>A(t,o,e.target.value)}),"\xb0"]})}),"shadow"===L.find((e=>e[0]===o))[1]&&(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{children:["Offset X",(0,n.jsx)("input",{type:"number",step:"1",value:e.filters[o][0],onChange:e=>A(t,o,e.target.value,0)}),"px"]}),(0,n.jsxs)("div",{children:["Offset Y",(0,n.jsx)("input",{type:"number",step:"1",value:e.filters[o][1],onChange:e=>A(t,o,e.target.value,1)}),"px"]}),(0,n.jsxs)("div",{children:["Blur:",(0,n.jsx)("input",{type:"number",min:"0",step:"1",value:e.filters[o][2],onChange:e=>A(t,o,e.target.value,2)}),"px"]}),(0,n.jsxs)("div",{children:["Color:",(0,n.jsx)(m.A,{color:e.filters[o][3],setColor:e=>A(t,o,e,3),useAlpha:!0})]})]}),(0,n.jsx)("button",{title:"Delete Filter","aria-label":"Delete Filter",onClick:()=>((e,t)=>{const o=[...p];delete o[e].filters[t],g(o)})(t,o),children:(0,n.jsx)(w.$8F,{})})]},o)))})]}),0===t&&(0,n.jsx)("hr",{style:{display:I===t?"block":"none"}})]},e.id))),I===p.length&&(0,n.jsx)("hr",{}),(0,n.jsx)("button",{onClick:()=>{(()=>{const e={id:b+1,name:`Layer ${b+1}`,blending:"normal",filters:{},opacity:1,visible:!0,locked:!1,canUndo:!1,canRedo:!1};g([...p,e]),x(p.length),j(b+1),o("New Layer")})()},children:"New Layer"})]})]})}function M(e){let{action:t,setAction:o,contextMenu:r,appMenu:s,setAppMenu:i}=e;const c=(0,a.useContext)(l),[d,h]=(0,a.useState)(!1),[u,x]=(0,a.useState)("Layers");if(c.view.contentBar)return(0,n.jsxs)("div",{id:"drawDocContentBar",onContextMenu:e=>(e=>{e.preventDefault();let t={Hide:{action:()=>o("contentBar")}};r.setOpen(),r.setPosition(e.clientX,e.clientY),r.setContent(t)})(e),children:[(0,n.jsxs)("nav",{children:[(0,n.jsx)("button",{onClick:()=>h(!d),children:d?(0,n.jsx)(b.NBD,{}):(0,n.jsx)(b.UkA,{})}),(0,n.jsx)("ul",{children:(0,n.jsx)("li",{onClick:()=>{x("Layers"),h(!0)},style:{textDecoration:"Layers"===u?"underline":"none"},children:"Layers"})})]}),(0,n.jsx)("div",{style:{width:d?"auto":"0"},children:(0,n.jsx)(j,{action:t,setAction:o,contextMenu:r,appMenu:s,setAppMenu:i})})]})}function P(){const e=(0,a.useContext)(l),t=(e.tool,e.clipboard),o=e.cursor,r=(e.zoom,e.currLayer);e.layers;return(0,n.jsx)("canvas",{id:"carryCanvas",height:t.data.height,width:t.data.width,style:{display:"none",position:"absolute",zIndex:r,top:o.end.y+"px",left:o.end.x+"px"}})}function k(e){let{setAction:t,contextMenu:o}=e;const r=(0,a.useContext)(l),s=(0,a.useRef)(null),i=r.cursor,c=r.setCursor,d=r.tool,h=r.subTool,u=r.curveControls,x=r.setCurveControls,p=r.size,g=r.color.selected,b=r.color[1],m=r.color[2],y=r.text,v=r.setText,f=r.clipboard,w=r.setClipboard,C=r.layers,j=r.currLayer,M={tool:d,subTool:h,curveControls:u,setCurveControls:x,size:p,selectedColor:g,color1:b,setColor1:e=>r.setColor({...r.color,1:e}),color2:m,setColor2:e=>r.setColor({...r.color,2:e}),text:y,setText:v,clipboard:f,setClipboard:w},P=(e,t)=>{let o=s.current,a=o.getContext("2d",{alpha:!0}),n=o.getBoundingClientRect();const l=a.canvas.width/n.width,r=a.canvas.height/n.height;return{x:(e-n.left)*l,y:(t-n.top)*r}},k=e=>{const t=P(e.clientX,e.clientY);if(0===e.button)switch(e.type){case"mousedown":i.down?c({...i,current:{x:t.x,y:t.y},end:{x:t.x,y:t.y}}):c({...i,down:!0,start:{x:t.x,y:t.y}});break;case"mouseup":c({...i,end:{x:t.x,y:t.y},down:!1});break;case"mousemove":i.down?c({...i,current:{x:t.x,y:t.y},end:{x:t.x,y:t.y}}):c({...i,current:{x:t.x,y:t.y}});break;case"mouseleave":c({...i,current:{x:t.x,y:t.y}});break;case"mouseenter":0!==e.buttons?c({...i,down:!0,current:{x:t.x,y:t.y},end:{x:t.x,y:t.y}}):c({...i,down:!1,current:{x:t.x,y:t.y}})}},S=e=>{e.preventDefault();const t=P(e.touches[0].clientX,e.touches[0].clientY);if(1===e.touches.length)switch(e.type){case"touchstart":i.down?c({...i,current:{x:t.x,y:t.y},end:{x:t.x,y:t.y}}):c({...i,down:!0,start:{x:t.x,y:t.y}});break;case"touchend":c({...i,end:{x:t.x,y:t.y},down:!1});break;case"touchmove":i.down?c({...i,current:{x:t.x,y:t.y},end:{x:t.x,y:t.y}}):c({...i,current:{x:t.x,y:t.y}})}else c({...i,current:{x:0,y:0},end:{x:t.x,y:t.y},down:!1})};return(0,n.jsx)("canvas",{ref:s,style:{position:"absolute",top:0,left:0,color:M.selectedColor,zIndex:C.length+2},className:C[j].locked?"cursorLocked":"cursor"+M.tool,id:"interfaceCanvas",height:r.dimentions.height,width:r.dimentions.width,onMouseDown:e=>{i.selecting||k(e)},onMouseUp:e=>{i.selecting||k(e)},onMouseMove:e=>{i.selecting||k(e)},onMouseLeave:e=>{i.selecting||k(e)},onMouseEnter:e=>{i.selecting||k(e)},onTouchStart:e=>{i.selecting||S(e)},onTouchEnd:e=>{i.selecting||S(e)},onTouchMove:e=>{i.selecting||S(e)},onTouchCancel:e=>{i.selecting||S(e)},onContextMenu:e=>{i.selecting||(e=>{e.preventDefault();let a={Undo:{action:()=>t("Undo"),disabled:!r.history.canUndo||C[j].locked},Redo:{action:()=>t("Redo"),disabled:!r.history.canRedo||C[j].locked},LineBreak:{},"Zoom In":{action:()=>t("Zoom In"),disabled:4===r.zoom},"Zoom Out":{action:()=>t("Zoom Out"),disabled:.25===r.zoom},"Zoom Reset":{action:()=>t("Zoom Reset"),disabled:1===r.zoom}};o.setOpen(),o.setPosition(e.clientX,e.clientY),o.setContent(a)})(e)}})}var S=o(7980),T=o(184),D=o(5051),I=o(3825);const B=e=>{let{setAction:t,contextMenu:o}=e;const r=(0,a.useContext)(l);if(r.view.topNavBar)return(0,n.jsxs)("nav",{id:"drawDocTopNavBar",onContextMenu:e=>(e=>{e.preventDefault();let a={Hide:{action:()=>t("topNavBar")}};o.setOpen(),o.setPosition(e.clientX,e.clientY),o.setContent(a)})(e),children:[(0,n.jsx)("button",{title:"Undo",onClick:()=>t("Undo"),disabled:!r.layers[r.currLayer].canUndo||r.layers[r.currLayer].locked,children:(0,n.jsx)(f.qHd,{})}),(0,n.jsx)("button",{title:"Redo",onClick:()=>t("Redo"),disabled:!r.layers[r.currLayer].canRedo||r.layers[r.currLayer].locked,children:(0,n.jsx)(f.qQW,{})}),(0,n.jsx)("vertical-rect",{}),(0,n.jsx)("button",{title:"New File",onClick:()=>t("New"),children:(0,n.jsx)(S.QB2,{})}),(0,n.jsx)("button",{title:"Download File",onClick:()=>t("Save"),children:(0,n.jsx)(S.RZ0,{})}),(0,n.jsx)("vertical-rect",{}),(0,n.jsx)("button",{title:"Upload Image",onClick:()=>t("Image"),disabled:r.layers[r.currLayer].locked,children:(0,n.jsx)(T.dkL,{})}),(0,n.jsx)("vertical-rect",{}),(0,n.jsxs)("div",{style:{display:"flex"},children:[(0,n.jsx)("button",{title:"Color 1",className:r.color.selected===r.color[1]?"buttonActive":"",onClick:()=>r.setColor({...r.color,selected:r.color[1]}),children:(0,n.jsx)("label",{htmlFor:"drawColor1",style:{textDecoration:r.color.selected===r.color[1]?"underline":""},onClick:e=>e.preventDefault(),children:"1"})}),(0,n.jsx)(m.A,{color:r.color[1],setColor:e=>{r.setColor({...r.color,selected:e,1:e})},useAlpha:!0})]}),(0,n.jsx)("vertical-rect",{}),(0,n.jsxs)("div",{style:{display:"flex"},children:[(0,n.jsx)("button",{title:"Color 2",className:r.color.selected===r.color[2]?"buttonActive":"",onClick:()=>r.setColor({...r.color,selected:r.color[2]}),children:(0,n.jsx)("label",{htmlFor:"drawColor2",style:{textDecoration:r.color.selected===r.color[2]?"underline":""},onClick:e=>e.preventDefault(),children:"2"})}),(0,n.jsx)(m.A,{color:r.color[2],setColor:e=>r.setColor({...r.color,selected:e,2:e}),useAlpha:!0})]}),(0,n.jsx)("vertical-rect",{}),"Magnifier"===r.tool&&(0,n.jsxs)("select",{value:r.zoom,onChange:e=>{(e=>{r.setZoom(Number(e.target.value)),"0.25"===e.target.value?t("Zoom Min"):"4"===e.target.value?t("Zoom Max"):"1"===e.target.value?t("Zoom Default"):t("Zoom Change")})(e)},title:"Zoom",children:[(0,n.jsx)("option",{value:.25,children:"25%"}),(0,n.jsx)("option",{value:.5,children:"50%"}),(0,n.jsx)("option",{value:.75,children:"75%"}),(0,n.jsx)("option",{value:1,children:"100%"}),(0,n.jsx)("option",{value:2,children:"200%"}),(0,n.jsx)("option",{value:3,children:"300%"}),(0,n.jsx)("option",{value:4,children:"400%"})]}),"Select"!==r.tool&&"Pipette"!==r.tool&&"Magnifier"!==r.tool&&"Bucket"!==r.tool&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(I._DL,{}),(0,n.jsx)("input",{type:"number",min:"1",max:"100",value:r.size,onChange:e=>r.setSize(Number(e.target.value)),title:"Text"===r.tool?"Font Size":"Shape"===r.tool?"Line Width":"Radius"})]}),"Text"===r.tool&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("vertical-rect",{}),(0,n.jsx)(y.Oui,{}),(0,n.jsxs)("select",{title:"Font Family",value:r.text.fontFamily,onChange:e=>r.setText({...r.text,fontFamily:e.target.value}),children:[(0,n.jsx)("option",{children:"Arial"}),(0,n.jsx)("option",{children:"Times New Roman"}),(0,n.jsx)("option",{children:"Monospace"}),(0,n.jsx)("option",{children:"Verdana"}),(0,n.jsx)("option",{children:"Georgia"}),(0,n.jsx)("option",{children:"Courier New"}),(0,n.jsx)("option",{children:"Tahoma"}),(0,n.jsx)("option",{children:"Garamond"}),(0,n.jsx)("option",{children:"Impact"}),(0,n.jsx)("option",{children:"Comic Sans MS"}),(0,n.jsx)("option",{children:"Lucida Console"}),(0,n.jsx)("option",{children:"Lucida Sans Unicode"}),(0,n.jsx)("option",{children:"Palatino Linotype"}),(0,n.jsx)("option",{children:"Symbol"}),(0,n.jsx)("option",{children:"Wingdings"}),(0,n.jsx)("option",{children:"Helvetica"})]}),(0,n.jsx)("vertical-rect",{}),(0,n.jsx)(D.kZ9,{}),(0,n.jsx)("input",{title:"Line Height",type:"number",step:"0.01",min:"0",value:r.text.lineHeight,onChange:e=>{r.setText({...r.text,lineHeight:e.target.value})}}),(0,n.jsx)("vertical-rect",{})]}),"Shape"===r.tool&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("vertical-rect",{}),(0,n.jsx)(y.u8p,{}),(0,n.jsxs)("select",{title:"Shape",value:r.subTool.shape,onChange:e=>r.setSubTool({...r.subTool,shape:e.target.value}),children:[(0,n.jsx)("option",{children:"Line"}),(0,n.jsx)("option",{children:"Curve"}),(0,n.jsx)("option",{children:"Circle"}),(0,n.jsx)("option",{children:"Rectangle"}),(0,n.jsx)("option",{children:"Squagle"}),(0,n.jsx)("option",{children:"Polygon"}),(0,n.jsx)("option",{children:"Star"}),(0,n.jsx)("option",{children:"Arrow"}),(0,n.jsx)("option",{children:"Heart"})]}),(0,n.jsx)("vertical-rect",{}),("Polygon"===r.subTool.shape||"Star"===r.subTool.shape)&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(f.RIm,{}),(0,n.jsx)("input",{type:"number",title:"Sides",value:r.subTool.sides,onChange:e=>r.setSubTool({...r.subTool,sides:e.target.value}),min:"3",step:"1"}),(0,n.jsx)("vertical-rect",{})]})]})]})},L=e=>{let{subtool:t,isSelected:o}=e,l=(0,a.useRef)(null);const r={drawCircleIcon:(e,o,a)=>{e.beginPath(),e.arc(o/2,a/2,a/2-2,0,2*Math.PI),t.fill&&e.fill(),e.stroke(),e.closePath()},drawEllipseIcon:(e,o,a)=>{e.scale(1,.5),e.beginPath(),e.beginPath(),e.arc(o/2,a,a/2-2,0,2*Math.PI),t.fill&&e.fill(),e.stroke(),e.closePath(),e.scale(1,2)},drawRectangleIcon:(e,o,a)=>{t.fill&&e.fillRect(0,a/4,o,a/2),e.strokeRect(0,a/4,o,a/2)},drawSquagleIcon:(e,o,a)=>{e.beginPath(),e.roundRect(0,a/4,o,a/2,10),e.stroke(),t.fill&&e.fill()},drawPolygonIcon:(e,o,a)=>{e.beginPath();for(let n=0;n<t.sides;n++)e.lineTo(o/2+(o/2-3)*Math.cos(2*Math.PI*n/t.sides-Math.PI/2),a/2+(a/2-3)*Math.sin(2*Math.PI*n/t.sides-Math.PI/2));e.closePath(),e.stroke(),t.fill&&e.fill()},drawLineIcon:(e,t,o)=>{e.beginPath(),e.moveTo(t/4,2),e.lineTo(3*t/4,o-2),e.closePath(),e.stroke()},drawCurveIcon:(e,t,o)=>{e.beginPath(),e.moveTo(t/6,2),e.bezierCurveTo(5*t/6,o/5,t/6,4*o/5-2,5*t/6,o-2),e.stroke()},drawStarIcon:(e,o,a)=>{e.beginPath(),e.moveTo(o/2,3);for(let n=0;n<2*t.sides;n++)n%2===0?e.lineTo(o/2+(o/2-3)*Math.cos(2*Math.PI*n/(2*t.sides)-Math.PI/2),a/2+(a/2-3)*Math.sin(2*Math.PI*n/(2*t.sides)-Math.PI/2)):e.lineTo(o/2+(o/4-3)*Math.cos(2*Math.PI*n/(2*t.sides)-Math.PI/2),a/2+(a/4-3)*Math.sin(2*Math.PI*n/(2*t.sides)-Math.PI/2));e.closePath(),e.stroke(),t.fill&&e.fill()},drawArrowIcon:(e,o,a)=>{e.beginPath(),e.moveTo(2,a/3),e.lineTo(o/2,a/3),e.lineTo(o/2,2),e.lineTo(o-2,a/2),e.lineTo(o/2,a-2),e.lineTo(o/2,2*a/3),e.lineTo(2,2*a/3),e.closePath(),e.stroke(),t.fill&&e.fill()},drawHeartIcon:(e,o,a)=>{e.beginPath(),e.moveTo(o/2,a-3),e.arc(o/4+1,a/3,o/4-1,3*Math.PI/4,0,!1),e.arc(3*o/4-1,a/3,o/4-1,Math.PI,Math.PI/4,!1),e.closePath(),e.stroke(),t.fill&&e.fill()}};return(0,a.useEffect)((()=>{const e=l.current.getContext("2d"),o=e.canvas.height,a=e.canvas.width;e.clearRect(0,0,a,o),e.fillStyle=getComputedStyle(document.getElementById("drawDocToolBar")).color,e.strokeStyle=getComputedStyle(document.getElementById("drawDocToolBar")).color,e.lineWidth=2,r["draw"+t.shape+"Icon"](e,a,o)}),[t,o]),(0,n.jsx)("canvas",{ref:l,id:"shapeCanvas",width:"25",height:"25",title:"Custom Shape"})};var N=o(2639),E=o(8973),A=o(2021),z=o(7962),R=o(9698);const $=e=>{let{setAction:t,contextMenu:o,isSelected:r}=e;const s=(0,a.useContext)(l),i=s.tool,c=s.subTool,d=s.setTool,h={Brush:(0,n.jsx)(N.Nw5,{title:"Brush"}),Eraser:(0,n.jsx)(S.qpr,{title:"Eraser"}),Bucket:(0,n.jsx)(S.ATI,{title:"Bucket"}),Spray:(0,n.jsx)(S.bOX,{title:"Spray Can"}),Text:(0,n.jsx)(A.tEi,{title:"Insert Text"}),Pipette:(0,n.jsx)(E._e3,{title:"Color Picker"}),Magnifier:(0,n.jsx)(z.JJh,{title:"Zoom"}),Select:(0,n.jsx)(R.ZdE,{title:"Selection"}),Shape:(0,n.jsx)(L,{subtool:c,isSelected:r})};if(s.view.toolBar)return(0,n.jsx)("nav",{id:"drawDocToolBar",onContextMenu:e=>(e=>{e.preventDefault();let a={Hide:{action:()=>t("toolBar")}};o.setOpen(),o.setPosition(e.clientX,e.clientY),o.setContent(a)})(e),children:Object.keys(h).map((e=>(0,n.jsx)("button",{onClick:()=>d(e),className:i===e?"buttonActive":"",children:h[e]},e+"drawToolDropdown")))})},F=e=>{let{action:t,setAction:o,contextMenu:r}=e;const s=(0,a.useContext)(l);if(s.view.bottomNavBar)return(0,n.jsxs)("nav",{id:"drawDocBottomNavBar",onContextMenu:e=>(e=>{e.preventDefault();let t={Hide:{action:()=>o("bottomNavBar")}};r.setOpen(),r.setPosition(e.clientX,e.clientY),r.setContent(t)})(e),children:["Text"===s.tool&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{title:"Confirm Text",onClick:()=>o("confirm"),disabled:s.layers[s.currLayer].locked,children:(0,n.jsx)("small",{children:"Confirm"})}),(0,n.jsx)("vertical-rect",{}),(0,n.jsx)("button",{title:"Use Fill",className:s.text.fill?"buttonActive":"",onClick:()=>{s.setText({...s.text,fill:!s.text.fill})},children:(0,n.jsx)("small",{children:"Fill"})}),(0,n.jsx)("vertical-rect",{}),(0,n.jsx)("button",{title:"Use Stroke",className:s.text.stroke?"buttonActive":"",onClick:()=>{s.setText({...s.text,stroke:!s.text.stroke})},children:(0,n.jsx)("small",{children:"Stroke"})}),(0,n.jsx)("input",{title:"Stroke Width",type:"number",step:"1",min:"1",max:s.size-1,value:s.text.strokeWidth,onChange:e=>{s.setText({...s.text,strokeWidth:e.target.value})}}),(0,n.jsx)("vertical-rect",{})]}),"Select"===s.tool?(0,n.jsx)(n.Fragment,{children:"clipping"===t&&"carry"===s.clipboard.state?(0,n.jsx)("button",{title:"Paste",onClick:()=>{o("confirm"),s.setClipboard({...s.clipboard,state:"paste"})},disabled:s.layers[s.currLayer].locked,children:(0,n.jsx)("small",{children:"Paste"})}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{title:"Cut",onClick:()=>{o("clipping"),s.setClipboard({...s.clipboard,state:"cut"})},children:(0,n.jsx)("small",{children:"Cut"})}),(0,n.jsx)("vertical-rect",{}),(0,n.jsx)("button",{title:"Copy",onClick:()=>{o("clipping"),s.setClipboard({...s.clipboard,state:"copy"})},children:(0,n.jsx)("small",{children:"Copy"})})]})}):null,"Shape"===s.tool?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{title:"Confirm Shape",onClick:()=>o("confirm"),disabled:s.layers[s.currLayer].locked,children:(0,n.jsx)("small",{children:"Confirm"})}),(0,n.jsx)("vertical-rect",{}),"Curve"===s.subTool.shape&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{title:"Cancel Shape",onClick:()=>o("cancel"),children:(0,n.jsx)("small",{children:"Cancel"})}),(0,n.jsx)("vertical-rect",{})]}),"Line"!==s.subTool.shape&&"Curve"!==s.subTool.shape?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{title:"Fill",className:s.subTool.fill?"buttonActive":"",onClick:()=>s.setSubTool({...s.subTool,fill:!s.subTool.fill}),children:(0,n.jsx)("small",{children:"Fill"})}),(0,n.jsx)("vertical-rect",{}),"Rectangle"!==s.subTool.shape&&"Squagle"!==s.subTool.shape&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{title:"Stretch",className:s.subTool.stretch?"buttonActive":"",onClick:()=>s.setSubTool({...s.subTool,stretch:!s.subTool.stretch}),children:(0,n.jsx)("small",{children:"Stretch"})}),(0,n.jsx)("vertical-rect",{})]}),(0,n.jsxs)("button",{children:[(0,n.jsx)("label",{htmlFor:"rotationAngle",children:"Rotation"}),(0,n.jsx)("input",{type:"number",title:"Rotation Angle",id:"rotationAngle",value:s.subTool.angle,onChange:e=>s.setSubTool({...s.subTool,angle:e.target.value}),step:"1"})]}),(0,n.jsx)("vertical-rect",{}),"Polygon"===s.subTool.shape||"Star"===s.subTool.shape?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("button",{children:[(0,n.jsx)("label",{htmlFor:"startAngle",children:"Start Angle"}),(0,n.jsx)("input",{type:"number",title:"Start Angle",id:"startAngle",value:s.subTool.startAngle,onChange:e=>s.setSubTool({...s.subTool,startAngle:e.target.value}),step:"1"})]}),(0,n.jsx)("vertical-rect",{})]}):null]}):null,"Line"===s.subTool.shape&&"Curve"===s.subTool.shape&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("button",{children:[(0,n.jsx)("label",{htmlFor:"lineCap",children:"Cap"}),(0,n.jsxs)("select",{id:"lineCap",value:s.subTool.lineCap,onChange:e=>s.setSubTool({...s.subTool,lineCap:e.target.value}),children:[(0,n.jsx)("option",{value:"butt",children:"Butt"}),(0,n.jsx)("option",{value:"round",children:"Round"}),(0,n.jsx)("option",{value:"square",children:"Square"})]})]}),(0,n.jsx)("vertical-rect",{})]}),"Line"!==s.subTool.shape&&"Curve"!==s.subTool.shape&&"Squagle"!==s.subTool.shape&&"Rectangle"!==s.subTool.shape&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("button",{children:[(0,n.jsx)("label",{htmlFor:"lineJoin",children:"Joints"}),(0,n.jsxs)("select",{id:"lineJoin",value:s.subTool.lineJoin,onChange:e=>s.setSubTool({...s.subTool,lineJoin:e.target.value}),children:[(0,n.jsx)("option",{value:"miter",children:"Miter"}),(0,n.jsx)("option",{value:"round",children:"Round"}),(0,n.jsx)("option",{value:"bevel",children:"Bevel"})]})]}),(0,n.jsx)("vertical-rect",{})]}),"Squagle"===s.subTool.shape&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("button",{children:[(0,n.jsx)("label",{htmlFor:"topleft",children:"Top Left"}),(0,n.jsx)("input",{id:"topleft",type:"number",step:"1",min:"0",value:s.subTool.radii[0],onChange:e=>s.setSubTool({...s.subTool,radii:[e.target.value,...s.subTool.radii.slice(1)]})})]}),(0,n.jsx)("vertical-rect",{}),(0,n.jsxs)("button",{children:[(0,n.jsx)("label",{htmlFor:"topright",children:"Top Right"}),(0,n.jsx)("input",{id:"topright",type:"number",step:"1",min:"0",value:s.subTool.radii[1],onChange:e=>s.setSubTool({...s.subTool,radii:[...s.subTool.radii.slice(0,1),e.target.value,...s.subTool.radii.slice(2)]})})]}),(0,n.jsx)("vertical-rect",{}),(0,n.jsxs)("button",{children:[(0,n.jsx)("label",{htmlFor:"bottomright",children:"Bottom Right"}),(0,n.jsx)("input",{id:"bottomright",type:"number",step:"1",min:"0",value:s.subTool.radii[2],onChange:e=>s.setSubTool({...s.subTool,radii:[...s.subTool.radii.slice(0,2),e.target.value,s.subTool.radii[3]]})})]}),(0,n.jsx)("vertical-rect",{}),(0,n.jsxs)("button",{children:[(0,n.jsx)("label",{htmlFor:"bottomleft",children:"Bottom Left"}),(0,n.jsx)("input",{id:"bottomleft",type:"number",step:"1",min:"0",value:s.subTool.radii[3],onChange:e=>s.setSubTool({...s.subTool,radii:[...s.subTool.radii.slice(0,3),e.target.value]})})]}),(0,n.jsx)("vertical-rect",{})]})]}):null]})};function U(e){const t=e.action,o=e.setAction,s=e.appMenu,i=e.setAppMenu,c=e.appDialog,d=e.setAppDialog,h=e.contextMenu,u=e.canClose,b=e.setCanClose,m=e.isSelected,y=e.title,v=e.setTitle;(0,a.useContext)(l);return(0,n.jsx)(r,{children:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(B,{setAction:o,contextMenu:h}),(0,n.jsxs)("div",{style:{display:"flex",flexDirection:"row",width:"100%",height:"100%",margin:"0px"},children:[(0,n.jsx)($,{setAction:o,contextMenu:h,isSelected:m}),(0,n.jsxs)("canvas-container",{children:[(0,n.jsx)(x,{action:t,setAction:o,appMenu:s,setAppMenu:i,appDialog:c,setAppDialog:d,contextMenu:h,canClose:u,setCanClose:b,title:y,setTitle:v}),(0,n.jsx)(P,{}),(0,n.jsx)(p,{}),(0,n.jsx)(k,{action:t,setAction:o,contextMenu:h}),(0,n.jsx)(g,{})]}),(0,n.jsx)(M,{action:t,setAction:o,contextMenu:h,appMenu:s,setAppMenu:i})]}),(0,n.jsx)(F,{action:t,setAction:o,contextMenu:h})]})})}},9106:(e,t,o)=>{o.d(t,{A:()=>i});var a=o(5043),n=o(7950);function l(e){let t=e[0],o=e[1],a=e[2];t/=255,o/=255,a/=255;let n=Math.min(t,o,a),l=Math.max(t,o,a),r=l-n,s=0,i=0,c=(l+n)/2;return 0===r?(i=0,s=0):(i=c<=.5?r/(l+n):r/(2-l-n),l===t?s=(o-a)/r:l===o?s=(a-t)/r+2:l===a&&(s=(t-o)/r+4)),s=Math.round(60*s),s<0&&(s+=360),i=Math.abs(100*i).toFixed(0),c=(100*c).toFixed(0),[s,i+"%",c+"%"]}function r(e){var t=e[0],o=e[1],a=e[2],n=e[3];t=parseInt(e[1],16),o=parseInt(e[2],16),a=parseInt(e[3],16),n=parseInt(e[4],16);t/=255,o/=255,a/=255;let l=Math.min(t,o,a),r=Math.max(t,o,a),s=r-l,i=0,c=0,d=(r+l)/2;return 0===s?(c=0,i=0):(c=d<=.5?s/(r+l):s/(2-r-l),r===t?i=(o-a)/s:r===o?i=(a-t)/s+2:r===a&&(i=(t-o)/s+4)),i=Math.round(60*i),i<0&&(i+=360),c=Math.abs(100*c).toFixed(0),d=(100*d).toFixed(0),[i,c+"%",d+"%",n]}o(7915);var s=o(579);function i(e){let{color:t,setColor:o,useAlpha:i}=e;const c=(0,a.useRef)(null),d=(0,a.useRef)(null),h=(0,a.useRef)(null),u=(0,a.useRef)(null),[x,p]=(0,a.useState)({x:0,y:0}),[g,b]=(0,a.useState)(0),[m,y]=(0,a.useState)(0),[v,f]=(0,a.useState)(!1),[w,C]=(0,a.useState)(0),[j,M]=(0,a.useState)(50),[P,k]=(0,a.useState)(100),[S,T]=(0,a.useState)(100);(0,a.useEffect)((()=>{v&&c.current.focus()}),[v]);(0,a.useEffect)((()=>{if(t)if(i){let a=[];if("#"===t[0])a=r(function(e){var t;return 5===e.length?0==(t=/^#?([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i.exec(e))[4]&&(t[4]="ff"):9===e.length?t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e):8===e.length&&((t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e))[4]="ff"),t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),parseInt(t[4],16)/255]:null}(t));else if("rgba"===t.slice(0,4))a=r(t);else if("hsla"===t.slice(0,4))for(let n=0;n<t.length;n++){"("===t[n]?e=n+1:")"===t[n]?(o=n,a.push(t.slice(e,o))):","===t[n]&&(a.push(t.slice(e,n)),e=n+1)}if(C(Number(a[0])),k(Number(a[1].slice(0,a[1].length-1))),M(Number(a[2].slice(0,a[2].length-1))),T(Number(a[3])),v){const e=d.current.getBoundingClientRect();p({x:a[0]/360*e.width,y:(100-a[2].slice(0,a[2].length-1))/100*e.height});const t=h.current.getBoundingClientRect();b((100-a[1].slice(0,a[1].length-1))/100*t.height);const o=u.current.getBoundingClientRect();y(a[3]*o.width)}}else{let a=[];if("#"===t[0])a=l(function(e){var t;return(t=4===e.length?/^#?([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i.exec(e):/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e))?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}(t));else if("rgb"===t.slice(0,3))a=l(t);else if("hsl"===t.slice(0,3))for(let n=0;n<t.length;n++){var e,o;"("===t[n]?e=n+1:")"===t[n]?(o=n,a.push(t.slice(e,o))):","===t[n]&&(a.push(t.slice(e,n)),e=n+1)}else a=function(e){switch(e){case"red":case"maroon":return[0,"100%","50%"];case"green":case"lime":return[120,"100%","50%"];case"blue":case"aqua":case"navy":return[240,"100%","50%"];case"yellow":case"olive":return[60,"100%","50%"];case"cyan":case"teal":return[180,"100%","50%"];case"magenta":return[300,"100%","50%"];case"black":default:return[0,"0%","0%"];case"white":return[0,"0%","100%"];case"gray":case"grey":return[0,"0%","50%"];case"lightgray":case"lightgrey":return[0,"0%","75%"];case"darkgray":case"darkgrey":return[0,"0%","25%"];case"brown":return[30,"50%","50%"];case"orange":return[30,"100%","50%"];case"purple":return[270,"100%","50%"];case"pink":return[330,"100%","50%"]}}(t);if(C(Number(a[0])),k(Number(a[1].slice(0,a[1].length-1))),M(Number(a[2].slice(0,a[2].length-1))),v){const e=d.current.getBoundingClientRect();p({x:a[0]/360*e.width,y:(100-a[2].slice(0,a[2].length-1))/100*e.height});const t=h.current.getBoundingClientRect();b((100-a[1].slice(0,a[1].length-1))/100*t.height)}}}),[v,t,i]);(0,a.useEffect)((()=>{if(d.current){(e=>{e.clearRect(0,0,e.canvas.width,e.canvas.height);let t=e.canvas.width/360,o=e.canvas.height/100;for(let a=0;a<360;a++)for(let n=0;n<100;n++)e.fillStyle=`hsl(${a},${P}%,${100-n}%)`,e.fillRect(a*t,n*o,(a+1)*t,(n+1)*o)})(d.current.getContext("2d",{alpha:!1}))}}),[v,P]);const D=e=>{if(0!==e.buttons){const t=d.current.getBoundingClientRect();let o=e.clientX-t.left,a=e.clientY-t.top;o>=0&&o<=t.width&&a>=0&&a<=t.height&&(p({x:o,y:a}),C(Math.floor(360*o/t.width)),M(100-Math.floor(100*a/t.height)))}},I=e=>{if(1===e.touches.length){const t=d.current.getBoundingClientRect();let o=e.touches[0].clientX-t.left,a=e.touches[0].clientY-t.top;o>=0&&o<=t.width&&a>=0&&a<=t.height&&(p({x:o,y:a}),C(Math.floor(360*o/t.width)),M(100-Math.floor(100*a/t.height)))}},B=e=>{if(0!==e.buttons){const t=h.current.getBoundingClientRect();let o=e.clientX-t.left,a=e.clientY-t.top;o>=0&&o<=t.width&&a>=0&&a<=t.height&&(k(100-Math.floor(100*a/t.height)),b(a))}},L=e=>{if(1===e.touches.length){const t=h.current.getBoundingClientRect();let o=e.touches[0].clientX-t.left,a=e.touches[0].clientY-t.top;o>=0&&o<=t.width&&a>=0&&a<=t.height&&(k(100-Math.floor(100*a/t.height)),b(a))}},N=e=>{if(0!==e.buttons){const t=u.current.getBoundingClientRect();let o=e.clientX-t.left,a=e.clientY-t.top;o>=0&&o<=t.width&&a>=0&&a<=t.height&&(T(Math.floor(100*o/t.width)/100),y(o))}},E=e=>{if(1===e.touches.length){const t=u.current.getBoundingClientRect();let o=e.touches[0].clientX-t.left,a=e.touches[0].clientY-t.top;o>=0&&o<=t.width&&a>=0&&a<=t.height&&(T(Math.floor(100*o/t.width)/100),y(o))}};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("color-picker-button",{onClick:()=>f(!v),children:(0,s.jsx)("div",{children:(0,s.jsx)("button",{style:{background:t}})})}),v&&(0,n.createPortal)((0,s.jsxs)("color-picker-window",{tabIndex:"0",ref:c,onBlur:e=>{var t;(t=e).currentTarget.contains(t.relatedTarget)||f(!1)},children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("hue-light-map",{children:[(0,s.jsx)("canvas",{onMouseDown:e=>D(e),onMouseMove:e=>D(e),onTouchMove:e=>I(e),onTouchStart:e=>I(e),onTouchEnd:e=>I(e),ref:d,width:"180",height:"180",style:{opacity:i?S:1}}),(0,s.jsx)("slider-thumb",{style:{top:x.y,left:x.x,background:i?`hsla(${w},${P}%,${j}%, ${S})`:`hsl(${w},${P}%,${j}%)`},onMouseDown:e=>D(e),onMouseMove:e=>D(e),onTouchMove:e=>I(e),onTouchStart:e=>I(e),onTouchEnd:e=>I(e)})]}),(0,s.jsxs)("saturation-slider",{title:"Saturation",children:[(0,s.jsx)("div",{ref:h,style:{background:`linear-gradient(0deg, hsl(${w},0%,${j}%), hsla(${w},100%,${j}%))`},onMouseDown:e=>B(e),onMouseMove:e=>B(e),onTouchMove:e=>L(e),onTouchStart:e=>L(e),onTouchEnd:e=>L(e)}),(0,s.jsx)("slider-thumb",{style:{top:g,background:`hsla(${w},${P}%,${j}%, ${S})`},onMouseDown:e=>B(e),onMouseMove:e=>B(e),onTouchMove:e=>L(e),onTouchStart:e=>L(e),onTouchEnd:e=>L(e)})]})]}),i&&(0,s.jsxs)("alpha-slider",{title:"Alpha",children:[(0,s.jsx)("div",{ref:u,style:{background:`linear-gradient(90deg, hsla(${w},${P}%,${j}%, 0), hsla(${w},${P}%,${j}%, 1))`},onMouseDown:e=>N(e),onMouseMove:e=>N(e),onTouchMove:e=>E(e),onTouchStart:e=>E(e),onTouchEnd:e=>E(e)}),(0,s.jsx)("slider-thumb",{style:{left:m,background:`hsl(${w},${P}%,${j}%, ${S})`},onMouseDown:e=>N(e),onMouseMove:e=>N(e),onTouchMove:e=>E(e),onTouchStart:e=>E(e),onTouchEnd:e=>E(e)})]}),(0,s.jsxs)("color-inputs",{children:[(0,s.jsxs)("div",{children:["Hue",(0,s.jsx)("input",{type:"number",min:"0",max:"360",value:w,onChange:e=>(e=>{C(e);const t=d.current.getBoundingClientRect();p({...x,x:e/360*t.width})})(e.target.value)})]}),(0,s.jsxs)("div",{children:["Lum.",(0,s.jsx)("input",{type:"number",min:"0",max:"100",value:j,onChange:e=>(e=>{M(e);const t=d.current.getBoundingClientRect();p({...x,y:(100-e)/100*t.height})})(e.target.value)})]}),(0,s.jsxs)("div",{children:["Sat.",(0,s.jsx)("input",{type:"number",min:"0",max:"100",value:P,onChange:e=>(e=>{k(e);const t=h.current.getBoundingClientRect();b((100-e)/100*t.height)})(e.target.value)})]}),i&&(0,s.jsxs)("div",{children:["Alpha",(0,s.jsx)("input",{type:"number",min:"0",max:"1",step:"0.01",value:S,onChange:e=>(e=>{T(e);const t=u.current.getBoundingClientRect();y(e*t.width)})(e.target.value)})]})]}),(0,s.jsx)("color-button",{children:(0,s.jsx)("button",{style:{background:i?`hsla(${w},${P}%,${j}%, ${S})`:`hsl(${w},${P}%,${j}%)`},onClick:()=>{o(i?`hsla(${w},${P}%,${j}%, ${S})`:`hsl(${w},${P}%,${j}%)`)},children:"Apply"})})]}),document.getElementById("root"))]})}}}]);
//# sourceMappingURL=615.37165e59.chunk.js.map